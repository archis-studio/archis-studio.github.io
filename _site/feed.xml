<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="3.9.5">Jekyll</generator><link href="https://magicxcr7.github.io/feed.xml" rel="self" type="application/atom+xml" /><link href="https://magicxcr7.github.io/" rel="alternate" type="text/html" /><updated>2025-09-27T19:34:11+08:00</updated><id>https://magicxcr7.github.io/feed.xml</id><title type="html">Archis Digital Compass</title><subtitle>å°ˆæ¥­çš„æŠ€è¡“åˆ†äº«å¹³å°ï¼Œå°ˆæ³¨æ–¼ Backend é–‹ç™¼ã€Data Scienceã€é‡åŒ–äº¤æ˜“èˆ‡å€‹äººæˆé•·ã€‚è®“è¤‡é›œçš„æŠ€è¡“è®Šå¾—ç°¡å–®æ˜“æ‡‚ï¼Œé™ªä¼´æ‚¨åœ¨æ•¸ä½æ™‚ä»£ä¸­æˆé•·èŒå£¯ã€‚</subtitle><author><name>Archi Chen</name><email>magic83w@gmail.com</email></author><entry><title type="html">æ­¡è¿ä¾†åˆ°å…¨æ–°çš„ Archis Digital Compassï¼</title><link href="https://magicxcr7.github.io/personal-growth/welcome-to-new-archis-compass/" rel="alternate" type="text/html" title="æ­¡è¿ä¾†åˆ°å…¨æ–°çš„ Archis Digital Compassï¼" /><published>2024-12-19T10:00:00+08:00</published><updated>2024-12-19T10:00:00+08:00</updated><id>https://magicxcr7.github.io/personal-growth/welcome-to-new-archis-compass</id><content type="html" xml:base="https://magicxcr7.github.io/personal-growth/welcome-to-new-archis-compass/"><![CDATA[<p>å“ˆå›‰å¤§å®¶å¥½ï¼æˆ‘æ˜¯ Archi ğŸ‘‹</p>

<p>ç¶“éä¸€æ®µæ™‚é–“çš„é‡æ–°è¨­è¨ˆèˆ‡è¦åŠƒï¼Œ<strong>Archis Digital Compass</strong> å…¨æ–°æ”¹ç‰ˆæ­£å¼ä¸Šç·šå•¦ï¼ğŸ‰ é€™æ¬¡ä¸åªæ˜¯æ›å€‹æ–°è¡£æœé€™éº¼ç°¡å–®ï¼Œè€Œæ˜¯å¾å…§å®¹åˆ°è¨­è¨ˆéƒ½é‡æ–°æ€è€ƒï¼Œæ‰“é€ ä¸€å€‹çœŸæ­£é©åˆå°ç£æŠ€è¡“ç¤¾ç¾¤çš„åˆ†äº«å¹³å°ã€‚</p>

<!--more-->

<h2 id="ç‚ºä»€éº¼è¦é‡æ–°æ”¹ç‰ˆ-">ç‚ºä»€éº¼è¦é‡æ–°æ”¹ç‰ˆï¼Ÿ ğŸ¤”</h2>

<p>è€å¯¦èªªï¼Œä¹‹å‰çš„ç¶²ç«™é›–ç„¶åŠŸèƒ½å®Œæ•´ï¼Œä½†ç¸½è¦ºå¾—å°‘äº†é»ä»€éº¼ã€‚ç¶“éæ·±æ€ç†Ÿæ…®å¾Œï¼Œæˆ‘ç™¼ç¾äº†å¹¾å€‹å•é¡Œï¼š</p>

<h3 id="1-èªè¨€æ··ç”¨çš„å›°æ“¾">1. èªè¨€æ··ç”¨çš„å›°æ“¾</h3>
<p>ä»¥å‰çš„æ–‡ç« ä¸­è‹±å¤¾é›œï¼Œé›–ç„¶çœ‹èµ·ä¾†å¾ˆåœ‹éš›åŒ–ï¼Œä½†å°å°ç£è®€è€…ä¾†èªªå…¶å¯¦ä¸å¤ªå‹å–„ã€‚æŠ€è¡“æ–‡ç« æœ¬ä¾†å°±å·²ç¶“å¤ ç¡¬äº†ï¼Œå¦‚æœé‚„è¦åœ¨èªè¨€ä¸Šå¢åŠ é–±è®€éšœç¤™ï¼Œé‚£å°±æœ¬æœ«å€’ç½®äº† ğŸ˜…</p>

<h3 id="2-å…§å®¹åˆ†é¡ä¸å¤ æ¸…æ™°">2. å…§å®¹åˆ†é¡ä¸å¤ æ¸…æ™°</h3>
<p>ä¹‹å‰çš„åˆ†é¡å¤ªç± çµ±ï¼Œè®€è€…å¾ˆé›£å¿«é€Ÿæ‰¾åˆ°è‡ªå·±éœ€è¦çš„å…§å®¹ã€‚ç¾åœ¨æˆ‘æŠŠå…§å®¹é‡æ–°æ•´ç†ï¼Œåˆ†æˆæ›´å…·é«”çš„é ˜åŸŸã€‚</p>

<h3 id="3-ç¼ºä¹å€‹äººæº«åº¦">3. ç¼ºä¹å€‹äººæº«åº¦</h3>
<p>æŠ€è¡“éƒ¨è½æ ¼ä¸æ‡‰è©²åªæ˜¯å†·å†°å†°çš„æ•™å­¸æ–‡ä»¶ã€‚åŠ å…¥ä¸€äº›å€‹äººç¶“é©—ã€å¿ƒå¾—åˆ†äº«ï¼Œç”šè‡³å¶çˆ¾ä¾†é»å¹½é»˜ï¼Œæ‰èƒ½è®“è®€è€…æ„Ÿå—åˆ°çœŸå¯¦çš„äººå‘³ ğŸ˜Š</p>

<h2 id="å…¨æ–°ç¶²ç«™æœ‰ä»€éº¼ç‰¹è‰²-">å…¨æ–°ç¶²ç«™æœ‰ä»€éº¼ç‰¹è‰²ï¼Ÿ âœ¨</h2>

<h3 id="-å®Œå…¨ç¹é«”ä¸­æ–‡åŒ–">ğŸ‡¹ğŸ‡¼ å®Œå…¨ç¹é«”ä¸­æ–‡åŒ–</h3>
<p>é™¤äº†æŠ€è¡“è¡“èªä¿æŒè‹±æ–‡å¤–ï¼ˆç•¢ç«Ÿ Backendã€Data Science é€™äº›è©å·²ç¶“æ˜¯å…±åŒèªè¨€äº†ï¼‰ï¼Œå…¶ä»–å…§å®¹éƒ½ç”¨ç¹é«”ä¸­æ–‡æ’°å¯«ã€‚è®“å°ç£çš„æœ‹å‹å€‘å¯ä»¥æ›´è¼•é¬†åœ°é–±è®€ï¼</p>

<h3 id="-æ›´è©³ç´°çš„åˆ†é¡ç³»çµ±">ğŸ“š æ›´è©³ç´°çš„åˆ†é¡ç³»çµ±</h3>
<p>æ–°çš„åˆ†é¡ç³»çµ±åŒ…æ‹¬ï¼š</p>

<p><strong>æŠ€è¡“é–‹ç™¼é¡</strong></p>
<ul>
  <li>ğŸ’» <strong>æŠ€è¡“åˆ†äº«</strong> - é€šç”¨çš„ç¨‹å¼è¨­è¨ˆç¶“é©—</li>
  <li>ğŸ”§ <strong>Backend é–‹ç™¼</strong> - ä¼ºæœå™¨ç«¯æŠ€è¡“æ·±åº¦æ¢è¨</li>
  <li>ğŸ“Š <strong>Data Engineering</strong> - è³‡æ–™å·¥ç¨‹å¯¦å‹™åˆ†äº«</li>
  <li>ğŸ¤– <strong>Data Science</strong> - æ©Ÿå™¨å­¸ç¿’èˆ‡è³‡æ–™åˆ†æ</li>
</ul>

<p><strong>é‡‘èç§‘æŠ€é¡</strong></p>
<ul>
  <li>ğŸ“ˆ <strong>é‡åŒ–äº¤æ˜“</strong> - æ¼”ç®—æ³•äº¤æ˜“ç­–ç•¥åˆ†äº«</li>
  <li>ğŸ’° <strong>é‡‘èç§‘æŠ€</strong> - FinTech æŠ€è¡“èˆ‡æ‡‰ç”¨</li>
</ul>

<p><strong>å…¶ä»–å°ˆæ¥­é ˜åŸŸ</strong></p>
<ul>
  <li>âš¡ <strong>èƒ½æºç®¡ç†</strong> - æ™ºæ…§é›»ç¶²èˆ‡ç¶ èƒ½ç§‘æŠ€</li>
  <li>ğŸ“¢ <strong>æ•¸ä½å»£å‘Š</strong> - è¡ŒéŠ·æŠ€è¡“èˆ‡æ•¸æ“šåˆ†æ</li>
  <li>ğŸŒŸ <strong>å€‹äººæˆé•·</strong> - è·æ¶¯ç™¼å±•èˆ‡å­¸ç¿’å¿ƒå¾—</li>
</ul>

<h3 id="-å¯¦æˆ°å°å‘çš„å…§å®¹">ğŸ¯ å¯¦æˆ°å°å‘çš„å…§å®¹</h3>
<p>æ¯ç¯‡æ–‡ç« éƒ½æœƒåŒ…å«ï¼š</p>
<ul>
  <li>ğŸ“ <strong>å¯¦éš›ç¨‹å¼ç¢¼ç¯„ä¾‹</strong></li>
  <li>ğŸ” <strong>è©³ç´°çš„æ­¥é©Ÿèªªæ˜</strong></li>
  <li>ğŸ’¡ <strong>å€‹äººå¿ƒå¾—èˆ‡è¸©å‘ç¶“é©—</strong></li>
  <li>ğŸš€ <strong>å¯ä»¥ç«‹å³æ‡‰ç”¨çš„æŠ€å·§</strong></li>
</ul>

<h2 id="æ¥ä¸‹ä¾†æœƒæœ‰å“ªäº›å…§å®¹-">æ¥ä¸‹ä¾†æœƒæœ‰å“ªäº›å…§å®¹ï¼Ÿ ğŸ“…</h2>

<p>æˆ‘å·²ç¶“æº–å‚™äº†ä¸€ç³»åˆ—çš„æ–‡ç« ä¸»é¡Œï¼Œé è¨ˆæ¯é€±æ›´æ–° 1-2 ç¯‡ï¼š</p>

<h3 id="è¿‘æœŸè¨ˆç•«-12æœˆ---1æœˆ">è¿‘æœŸè¨ˆç•« (12æœˆ - 1æœˆ)</h3>
<ul>
  <li>ğŸ”§ <strong>ã€ŒBackend é–‹ç™¼å¯¦æˆ°ç³»åˆ—ã€</strong> - å¾ API è¨­è¨ˆåˆ°å¾®æœå‹™æ¶æ§‹</li>
  <li>ğŸ“Š <strong>ã€ŒPython è³‡æ–™åˆ†æå¯¦å‹™ã€</strong> - ç”¨å¯¦éš›æ¡ˆä¾‹å­¸ Pandas èˆ‡ NumPy</li>
  <li>ğŸ“ˆ <strong>ã€Œé‡åŒ–äº¤æ˜“å…¥é–€ã€</strong> - å¾ç­–ç•¥ç™¼æƒ³åˆ°ç¨‹å¼å¯¦ä½œ</li>
</ul>

<h3 id="ä¸­æœŸè¦åŠƒ-2-4æœˆ">ä¸­æœŸè¦åŠƒ (2-4æœˆ)</h3>
<ul>
  <li>ğŸ¤– <strong>ã€ŒMachine Learning å¯¦æˆ°å°ˆæ¡ˆã€</strong> - å®Œæ•´çš„ ML å°ˆæ¡ˆæµç¨‹</li>
  <li>â˜ï¸ <strong>ã€Œé›²ç«¯æœå‹™æ•´åˆæŒ‡å—ã€</strong> - AWSã€GCP å¯¦å‹™æ‡‰ç”¨</li>
  <li>ğŸ’¡ <strong>ã€Œè·å ´ç”Ÿå­˜æŠ€èƒ½ã€</strong> - æŠ€è¡“äººçš„è»Ÿå¯¦åŠ›æå‡</li>
</ul>

<h3 id="é•·æœŸé¡˜æ™¯-å…¨å¹´">é•·æœŸé¡˜æ™¯ (å…¨å¹´)</h3>
<ul>
  <li>ğŸ“– å»ºç«‹å®Œæ•´çš„æŠ€è¡“çŸ¥è­˜é«”ç³»</li>
  <li>ğŸ¥ å¯èƒ½æœƒåŠ å…¥å½±ç‰‡æ•™å­¸å…§å®¹</li>
  <li>ğŸ¤ èˆ‡å…¶ä»–æŠ€è¡“ç¤¾ç¾¤åˆä½œäº¤æµ</li>
</ul>

<h2 id="çµ¦è®€è€…çš„å°æé†’-">çµ¦è®€è€…çš„å°æé†’ ğŸ“‹</h2>

<h3 id="å¦‚ä½•ç²å¾—æœ€ä½³é«”é©—">å¦‚ä½•ç²å¾—æœ€ä½³é«”é©—ï¼Ÿ</h3>
<ul>
  <li>ğŸ’¾ <strong>æ›¸ç±¤æ”¶è—</strong> - æŠŠå¸¸ç”¨çš„åˆ†é¡é é¢åŠ åˆ°æ›¸ç±¤</li>
  <li>ğŸ”” <strong>é—œæ³¨æ›´æ–°</strong> - è¿½è¹¤æˆ‘çš„ GitHub ç²å¾—æœ€æ–°å‹•æ…‹</li>
  <li>ğŸ’¬ <strong>ç©æ¥µäº’å‹•</strong> - åœ¨æ–‡ç« ä¸‹æ–¹ç•™è¨€åˆ†äº«ä½ çš„æƒ³æ³•</li>
</ul>

<h3 id="é‡åˆ°å•é¡Œæ€éº¼è¾¦">é‡åˆ°å•é¡Œæ€éº¼è¾¦ï¼Ÿ</h3>
<ul>
  <li>ğŸ› <strong>ç™¼ç¾éŒ¯èª¤</strong> - æ­¡è¿é€é Email æˆ– GitHub Issue å›å ±</li>
  <li>â“ <strong>æœ‰ç–‘å•</strong> - å¯ä»¥åœ¨æ–‡ç« ä¸‹æ–¹ç•™è¨€è¨è«–</li>
  <li>ğŸ’¡ <strong>å»ºè­°ä¸»é¡Œ</strong> - æƒ³çœ‹ä»€éº¼ä¸»é¡Œçš„æ–‡ç« ä¹Ÿå¯ä»¥å‘Šè¨´æˆ‘</li>
</ul>

<h2 id="ä¸€äº›ç¢ç¢å¿µ-">ä¸€äº›ç¢ç¢å¿µ ğŸ’­</h2>

<p>èªªå¯¦è©±ï¼Œç¶“ç‡ŸæŠ€è¡“éƒ¨è½æ ¼çœŸçš„ä¸å®¹æ˜“ã€‚è¦åœ¨å·¥ä½œä¹‹é¤˜æŒçºŒç”¢å‡ºæœ‰åƒ¹å€¼çš„å…§å®¹ï¼Œéœ€è¦å¾ˆå¤šçš„æ™‚é–“å’Œç²¾åŠ›ã€‚ä½†æ¯ç•¶æ”¶åˆ°è®€è€…çš„æ­£é¢å›é¥‹ï¼Œæˆ–æ˜¯çœ‹åˆ°è‡ªå·±çš„æ–‡ç« çœŸçš„å¹«åŠ©åˆ°åˆ¥äººè§£æ±ºå•é¡Œæ™‚ï¼Œé‚£ç¨®æˆå°±æ„Ÿæ˜¯ç„¡æ³•è¨€å–»çš„ ğŸ˜Š</p>

<p>æˆ‘å¸Œæœ›é€™å€‹ç¶²ç«™ä¸åªæ˜¯æˆ‘ä¸€å€‹äººçš„æŠ€è¡“ç­†è¨˜æœ¬ï¼Œæ›´èƒ½æˆç‚ºå°ç£æŠ€è¡“ç¤¾ç¾¤äº¤æµå­¸ç¿’çš„å°æ“šé»ã€‚å¦‚æœä½ ä¹Ÿæœ‰é¡ä¼¼çš„æƒ³æ³•ï¼Œæˆ–æ˜¯æƒ³è¦åˆ†äº«è‡ªå·±çš„ç¶“é©—ï¼Œæ­¡è¿èˆ‡æˆ‘è¯ç¹«ï¼</p>

<h3 id="ä¸€èµ·æ‰“é€ æ›´å¥½çš„æŠ€è¡“ç¤¾ç¾¤-">ä¸€èµ·æ‰“é€ æ›´å¥½çš„æŠ€è¡“ç¤¾ç¾¤ ğŸš€</h3>

<p>æœ€å¾Œï¼Œæˆ‘æƒ³èªªçš„æ˜¯ï¼š<strong>æŠ€è¡“çš„åƒ¹å€¼åœ¨æ–¼åˆ†äº«</strong>ã€‚ç„¡è«–ä½ æ˜¯å‰›å…¥é–€çš„æ–°æ‰‹ï¼Œé‚„æ˜¯ç¶“é©—è±å¯Œçš„è³‡æ·±å·¥ç¨‹å¸«ï¼Œæ¯å€‹äººéƒ½æœ‰å€¼å¾—åˆ†äº«çš„ç¶“é©—å’Œè§€é»ã€‚</p>

<p>åœ¨é€™å€‹å¿«é€Ÿè®ŠåŒ–çš„ç§‘æŠ€æ™‚ä»£ï¼Œæˆ‘å€‘æ›´éœ€è¦äº’ç›¸æ‰¶æŒã€å…±åŒå­¸ç¿’ã€‚å¸Œæœ›é€™å€‹å°å°çš„éƒ¨è½æ ¼èƒ½å¤ æˆç‚ºæˆ‘å€‘æŠ€è¡“äº¤æµçš„æ©‹æ¨‘ï¼Œè®“æ¯å€‹äººéƒ½èƒ½åœ¨é€™è£¡æ‰¾åˆ°æœ‰åƒ¹å€¼çš„å…§å®¹ï¼</p>

<hr />

<h2 id="è¯ç¹«æˆ‘-">è¯ç¹«æˆ‘ ğŸ“¬</h2>

<p>å¦‚æœä½ æœ‰ä»»ä½•å»ºè­°ã€å•é¡Œï¼Œæˆ–æ˜¯æƒ³è¦è¨è«–æŠ€è¡“è©±é¡Œï¼Œéƒ½æ­¡è¿èˆ‡æˆ‘è¯ç¹«ï¼š</p>

<ul>
  <li>ğŸ“§ <strong>Email</strong>: <a href="mailto:magic83w@gmail.com">magic83w@gmail.com</a></li>
  <li>ğŸ’» <strong>GitHub</strong>: <a href="https://github.com/magicxcr7">github.com/magicxcr7</a></li>
  <li>ğŸ”— <strong>LinkedIn</strong>: <a href="https://linkedin.com/in/archi-chen">linkedin.com/in/archi-chen</a></li>
</ul>

<div class="notice--success">
  <h4>ğŸ‰ æ­¡è¿åŠ å…¥æˆ‘å€‘çš„å­¸ç¿’ä¹‹æ—…ï¼</h4>
  <p>è¨˜å¾—å®šæœŸå›ä¾†çœ‹çœ‹æ–°æ–‡ç« ï¼Œä¹Ÿæ­¡è¿æŠŠé€™å€‹ç¶²ç«™æ¨è–¦çµ¦å…¶ä»–å°æŠ€è¡“æœ‰èˆˆè¶£çš„æœ‹å‹ï¼ä¸€èµ·å­¸ç¿’ï¼Œä¸€èµ·æˆé•· ğŸ’ª</p>
</div>

<p><em>æ„Ÿè¬æ‚¨çš„è€å¿ƒé–±è®€ï¼Œè®“æˆ‘å€‘åœ¨æŠ€è¡“çš„é“è·¯ä¸Šä¸€èµ·å‰é€²å§ï¼</em></p>]]></content><author><name>Archi Chen</name><email>magic83w@gmail.com</email></author><category term="personal-growth" /><category term="ç¶²ç«™æ›´æ–°" /><category term="å€‹äººå“ç‰Œ" /><category term="æŠ€è¡“åˆ†äº«" /><category term="æ­¡è¿" /><summary type="html"><![CDATA[å…¨æ–°æ”¹ç‰ˆçš„å€‹äººæŠ€è¡“éƒ¨è½æ ¼æ­£å¼ä¸Šç·šï¼é€™æ¬¡æˆ‘å€‘ç”¨ç¹é«”ä¸­æ–‡é‡æ–°æ‰“é€ ï¼Œå°ˆç‚ºå°ç£çš„æŠ€è¡“ç¤¾ç¾¤é‡èº«è¨­è¨ˆ ğŸš€]]></summary></entry><entry><title type="html">Python Backend API è¨­è¨ˆçš„çœ‰çœ‰è§’è§’</title><link href="https://magicxcr7.github.io/backend/technical/python-backend-api-best-practices/" rel="alternate" type="text/html" title="Python Backend API è¨­è¨ˆçš„çœ‰çœ‰è§’è§’" /><published>2024-12-18T14:30:00+08:00</published><updated>2024-12-18T14:30:00+08:00</updated><id>https://magicxcr7.github.io/backend/technical/python-backend-api-best-practices</id><content type="html" xml:base="https://magicxcr7.github.io/backend/technical/python-backend-api-best-practices/"><![CDATA[<p>æœ€è¿‘åœ¨ Code Review çš„æ™‚å€™ï¼Œç™¼ç¾åœ˜éšŠå¤¥ä¼´å€‘åœ¨ API è¨­è¨ˆä¸Šé‚„æœ‰å¾ˆå¤šå¯ä»¥æ”¹é€²çš„åœ°æ–¹ã€‚è¶è‘—é€™å€‹æ©Ÿæœƒï¼Œä¾†æ•´ç†ä¸€ä¸‹æˆ‘é€™å¹¾å¹´åœ¨ Python Backend é–‹ç™¼ä¸Šç´¯ç©çš„ä¸€äº›å¿ƒå¾— ğŸ¤“</p>

<p>èªªåˆ° API è¨­è¨ˆï¼Œå°±åƒè“‹æˆ¿å­ä¸€æ¨£ï¼Œåœ°åŸºæ‰“å¾—å¥½ä¸å¥½ï¼Œæ±ºå®šäº†æ•´å€‹ç³»çµ±çš„ç©©å®šæ€§ã€‚ä»Šå¤©å°±ä¾†åˆ†äº«ä¸€äº›å¯¦æˆ°ç¶“é©—ï¼Œå¸Œæœ›èƒ½å¹«åŠ©å¤§å®¶å°‘è¸©ä¸€äº›å‘ï¼</p>

<!--more-->

<h2 id="é¸æ“‡åˆé©çš„æ¡†æ¶-ï¸">é¸æ“‡åˆé©çš„æ¡†æ¶ ğŸ› ï¸</h2>

<h3 id="fastapi-vs-flask-vs-django-rest">FastAPI vs Flask vs Django REST</h3>

<p>é€™å€‹è€å•é¡Œäº†ï¼Œä½†é‚„æ˜¯å€¼å¾—å†èŠèŠï¼š</p>

<p><strong>FastAPI</strong> - æˆ‘çš„æ–°æ­¡ â¤ï¸</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">fastapi</span> <span class="kn">import</span> <span class="n">FastAPI</span><span class="p">,</span> <span class="n">HTTPException</span>
<span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="n">BaseModel</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">FastAPI</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">"æˆ‘çš„ API"</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="s">"1.0.0"</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">UserCreate</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">email</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">age</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="bp">None</span>

<span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="s">"/users/"</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">create_user</span><span class="p">(</span><span class="n">user</span><span class="p">:</span> <span class="n">UserCreate</span><span class="p">):</span>
    <span class="c1"># è‡ªå‹•ç”¢ç”Ÿ API æ–‡ä»¶ï¼Œå‹åˆ¥æª¢æŸ¥éƒ½å¹«ä½ æå®š
</span>    <span class="k">return</span> <span class="p">{</span><span class="s">"message"</span><span class="p">:</span> <span class="sa">f</span><span class="s">"ç”¨æˆ¶ </span><span class="si">{</span><span class="n">user</span><span class="p">.</span><span class="n">name</span><span class="si">}</span><span class="s"> å»ºç«‹æˆåŠŸï¼"</span><span class="p">}</span>
</code></pre></div></div>

<p><strong>ç‚ºä»€éº¼é¸ FastAPIï¼Ÿ</strong></p>
<ul>
  <li>ğŸš€ <strong>æ•ˆèƒ½è¶…å¥½</strong> - æ¥è¿‘ Node.js å’Œ Go çš„é€Ÿåº¦</li>
  <li>ğŸ“ <strong>è‡ªå‹•æ–‡ä»¶</strong> - Swagger UI è‡ªå‹•ç”Ÿæˆï¼Œçœå»å¯«æ–‡ä»¶çš„ç—›è‹¦</li>
  <li>ğŸ”’ <strong>å‹åˆ¥å®‰å…¨</strong> - ç”¨ Pydantic åšè³‡æ–™é©—è­‰ï¼ŒéŒ¯èª¤å°‘å¾ˆå¤š</li>
  <li>ğŸ”„ <strong>éåŒæ­¥æ”¯æ´</strong> - åŸç”Ÿæ”¯æ´ async/await</li>
</ul>

<h3 id="å¯¦éš›æ•ˆèƒ½æ¯”è¼ƒ">å¯¦éš›æ•ˆèƒ½æ¯”è¼ƒ</h3>

<p>æˆ‘ä¹‹å‰åšéä¸€å€‹ç°¡å–®çš„å£“åŠ›æ¸¬è©¦ï¼ˆç”¨ Apache Bench æ¸¬è©¦ 1000 å€‹ä½µç™¼è«‹æ±‚ï¼‰ï¼š</p>

<table>
  <thead>
    <tr>
      <th>æ¡†æ¶</th>
      <th>è«‹æ±‚/ç§’</th>
      <th>å¹³å‡å›æ‡‰æ™‚é–“</th>
      <th>è¨˜æ†¶é«”ä½¿ç”¨</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>FastAPI</td>
      <td>12,000</td>
      <td>83ms</td>
      <td>25MB</td>
    </tr>
    <tr>
      <td>Flask</td>
      <td>8,500</td>
      <td>118ms</td>
      <td>35MB</td>
    </tr>
    <tr>
      <td>Django REST</td>
      <td>6,200</td>
      <td>161ms</td>
      <td>45MB</td>
    </tr>
  </tbody>
</table>

<blockquote>
  <p>ğŸ“Š æ•¸æ“šåƒ…ä¾›åƒè€ƒï¼Œå¯¦éš›æ•ˆèƒ½æœƒå› æ‡‰ç”¨é‚è¼¯è€Œç•°</p>
</blockquote>

<h2 id="api-è¨­è¨ˆçš„é»ƒé‡‘æº–å‰‡-">API è¨­è¨ˆçš„é»ƒé‡‘æº–å‰‡ âœ¨</h2>

<h3 id="1-restful-è¨­è¨ˆè¦åšå°">1. RESTful è¨­è¨ˆè¦åšå°</h3>

<p>é€™å€‹å¤§å®¶éƒ½çŸ¥é“ï¼Œä½†å¯¦éš›åšèµ·ä¾†ç¸½æ˜¯æœƒæ­ªæ‰ ğŸ˜…</p>

<p><strong>âŒ å¸¸è¦‹çš„éŒ¯èª¤ï¼š</strong></p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># é€™æ¨£è¨­è¨ˆæœƒè¢« Backend å‰è¼©å€‘ç¿»ç™½çœ¼...
</span><span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="s">"/getUserById"</span><span class="p">)</span>  <span class="c1"># ç”¨ POST ä¾†æŸ¥è©¢ï¼Ÿ
</span><span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"/deleteUser/123"</span><span class="p">)</span>  <span class="c1"># ç”¨ GET ä¾†åˆªé™¤ï¼Ÿ
</span><span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">put</span><span class="p">(</span><span class="s">"/users/update/456"</span><span class="p">)</span>  <span class="c1"># URL è£¡é¢æœ‰å‹•è©ï¼Ÿ
</span></code></pre></div></div>

<p><strong>âœ… æ­£ç¢ºçš„åšæ³•ï¼š</strong></p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># æ¸…çˆ½ç°¡æ½”ï¼Œèªæ„æ˜ç¢º
</span><span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"/users/{user_id}"</span><span class="p">)</span>      <span class="c1"># å–å¾—ç”¨æˆ¶
</span><span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="s">"/users/"</span><span class="p">)</span>              <span class="c1"># å»ºç«‹ç”¨æˆ¶  
</span><span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">put</span><span class="p">(</span><span class="s">"/users/{user_id}"</span><span class="p">)</span>      <span class="c1"># æ›´æ–°ç”¨æˆ¶
</span><span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">delete</span><span class="p">(</span><span class="s">"/users/{user_id}"</span><span class="p">)</span>   <span class="c1"># åˆªé™¤ç”¨æˆ¶
</span></code></pre></div></div>

<h3 id="2-éŒ¯èª¤è™•ç†è¦å„ªé›…">2. éŒ¯èª¤è™•ç†è¦å„ªé›…</h3>

<p><strong>âŒ ç³Ÿç³•çš„éŒ¯èª¤è™•ç†ï¼š</strong></p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"/users/{user_id}"</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">get_user</span><span class="p">(</span><span class="n">user_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">database</span><span class="p">.</span><span class="n">get_user</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">user</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{</span><span class="s">"error"</span><span class="p">:</span> <span class="s">"æ‰¾ä¸åˆ°ç”¨æˆ¶"</span><span class="p">}</span>  <span class="c1"># æ²’æœ‰ HTTP ç‹€æ…‹ç¢¼ï¼Ÿ
</span></code></pre></div></div>

<p><strong>âœ… å°ˆæ¥­çš„éŒ¯èª¤è™•ç†ï¼š</strong></p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">fastapi</span> <span class="kn">import</span> <span class="n">HTTPException</span><span class="p">,</span> <span class="n">status</span>

<span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"/users/{user_id}"</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">get_user</span><span class="p">(</span><span class="n">user_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
    <span class="n">user</span> <span class="o">=</span> <span class="k">await</span> <span class="n">database</span><span class="p">.</span><span class="n">get_user</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">user</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="p">.</span><span class="n">HTTP_404_NOT_FOUND</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="p">{</span>
                <span class="s">"message"</span><span class="p">:</span> <span class="s">"æ‰¾ä¸åˆ°æŒ‡å®šçš„ç”¨æˆ¶"</span><span class="p">,</span>
                <span class="s">"error_code"</span><span class="p">:</span> <span class="s">"USER_NOT_FOUND"</span><span class="p">,</span>
                <span class="s">"user_id"</span><span class="p">:</span> <span class="n">user_id</span>
            <span class="p">}</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">user</span>
</code></pre></div></div>

<h3 id="3-çµ±ä¸€çš„å›æ‡‰æ ¼å¼">3. çµ±ä¸€çš„å›æ‡‰æ ¼å¼</h3>

<p>å»ºç«‹ä¸€è‡´çš„ API å›æ‡‰æ ¼å¼ï¼Œè®“å‰ç«¯åŒäº‹ä¸æœƒæƒ³æä½  ğŸ¤œ</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="n">BaseModel</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Optional</span>

<span class="k">class</span> <span class="nc">APIResponse</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">success</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">message</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">data</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">error_code</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>

<span class="c1"># æˆåŠŸçš„å›æ‡‰
</span><span class="k">return</span> <span class="n">APIResponse</span><span class="p">(</span>
    <span class="n">success</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
    <span class="n">message</span><span class="o">=</span><span class="s">"æ“ä½œæˆåŠŸ"</span><span class="p">,</span>
    <span class="n">data</span><span class="o">=</span><span class="n">user_data</span>
<span class="p">)</span>

<span class="c1"># å¤±æ•—çš„å›æ‡‰
</span><span class="k">return</span> <span class="n">APIResponse</span><span class="p">(</span>
    <span class="n">success</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> 
    <span class="n">message</span><span class="o">=</span><span class="s">"ç”¨æˆ¶åç¨±å·²å­˜åœ¨"</span><span class="p">,</span>
    <span class="n">error_code</span><span class="o">=</span><span class="s">"DUPLICATE_USERNAME"</span>
<span class="p">)</span>
</code></pre></div></div>

<h2 id="è³‡æ–™é©—è­‰èˆ‡æ¸…ç†-">è³‡æ–™é©—è­‰èˆ‡æ¸…ç† ğŸ§¹</h2>

<h3 id="pydantic-æ˜¯ä½ çš„å¥½æœ‹å‹">Pydantic æ˜¯ä½ çš„å¥½æœ‹å‹</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="n">BaseModel</span><span class="p">,</span> <span class="n">validator</span><span class="p">,</span> <span class="n">EmailStr</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Optional</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="k">class</span> <span class="nc">UserCreate</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">username</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">email</span><span class="p">:</span> <span class="n">EmailStr</span>
    <span class="n">password</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">age</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
    
    <span class="o">@</span><span class="n">validator</span><span class="p">(</span><span class="s">'username'</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">username_must_be_valid</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">raise</span> <span class="nb">ValueError</span><span class="p">(</span><span class="s">'ç”¨æˆ¶åç¨±è‡³å°‘è¦ 3 å€‹å­—å…ƒ'</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">re</span><span class="p">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s">'^[a-zA-Z0-9_]+$'</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
            <span class="k">raise</span> <span class="nb">ValueError</span><span class="p">(</span><span class="s">'ç”¨æˆ¶åç¨±åªèƒ½åŒ…å«è‹±æ•¸å­—å’Œåº•ç·š'</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">v</span>
    
    <span class="o">@</span><span class="n">validator</span><span class="p">(</span><span class="s">'password'</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">password_strength</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="p">:</span>
            <span class="k">raise</span> <span class="nb">ValueError</span><span class="p">(</span><span class="s">'å¯†ç¢¼è‡³å°‘è¦ 8 å€‹å­—å…ƒ'</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">re</span><span class="p">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s">'[A-Z]'</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
            <span class="k">raise</span> <span class="nb">ValueError</span><span class="p">(</span><span class="s">'å¯†ç¢¼éœ€è¦åŒ…å«å¤§å¯«å­—æ¯'</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">re</span><span class="p">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s">'[0-9]'</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
            <span class="k">raise</span> <span class="nb">ValueError</span><span class="p">(</span><span class="s">'å¯†ç¢¼éœ€è¦åŒ…å«æ•¸å­—'</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">v</span>
    
    <span class="o">@</span><span class="n">validator</span><span class="p">(</span><span class="s">'age'</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">age_must_be_reasonable</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="p">(</span><span class="n">v</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">v</span> <span class="o">&gt;</span> <span class="mi">150</span><span class="p">):</span>
            <span class="k">raise</span> <span class="nb">ValueError</span><span class="p">(</span><span class="s">'å¹´é½¡å¿…é ˆåœ¨ 0-150 ä¹‹é–“'</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">v</span>
</code></pre></div></div>

<h2 id="æ•ˆèƒ½å„ªåŒ–çš„å¯¦æˆ°æŠ€å·§-">æ•ˆèƒ½å„ªåŒ–çš„å¯¦æˆ°æŠ€å·§ ğŸš€</h2>

<h3 id="1-éåŒæ­¥ç¨‹å¼è¨­è¨ˆ">1. éåŒæ­¥ç¨‹å¼è¨­è¨ˆ</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">asyncio</span>
<span class="kn">import</span> <span class="nn">aiohttp</span>
<span class="kn">from</span> <span class="nn">concurrent.futures</span> <span class="kn">import</span> <span class="n">ThreadPoolExecutor</span>

<span class="c1"># âŒ åŒæ­¥ç‰ˆæœ¬ - æœƒé˜»å¡å…¶ä»–è«‹æ±‚
</span><span class="k">def</span> <span class="nf">get_user_with_profile</span><span class="p">(</span><span class="n">user_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">database</span><span class="p">.</span><span class="n">get_user</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>  <span class="c1"># 100ms
</span>    <span class="n">profile</span> <span class="o">=</span> <span class="n">api</span><span class="p">.</span><span class="n">get_user_profile</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>  <span class="c1"># 200ms  
</span>    <span class="n">settings</span> <span class="o">=</span> <span class="n">database</span><span class="p">.</span><span class="n">get_user_settings</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>  <span class="c1"># 50ms
</span>    <span class="k">return</span> <span class="n">merge_data</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">profile</span><span class="p">,</span> <span class="n">settings</span><span class="p">)</span>
    <span class="c1"># ç¸½æ™‚é–“ï¼š350ms
</span>
<span class="c1"># âœ… éåŒæ­¥ç‰ˆæœ¬ - å¹³è¡Œè™•ç†
</span><span class="k">async</span> <span class="k">def</span> <span class="nf">get_user_with_profile_async</span><span class="p">(</span><span class="n">user_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
    <span class="n">tasks</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">database</span><span class="p">.</span><span class="n">get_user_async</span><span class="p">(</span><span class="n">user_id</span><span class="p">),</span>
        <span class="n">api</span><span class="p">.</span><span class="n">get_user_profile_async</span><span class="p">(</span><span class="n">user_id</span><span class="p">),</span>
        <span class="n">database</span><span class="p">.</span><span class="n">get_user_settings_async</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="n">user</span><span class="p">,</span> <span class="n">profile</span><span class="p">,</span> <span class="n">settings</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="p">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="n">tasks</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">merge_data</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">profile</span><span class="p">,</span> <span class="n">settings</span><span class="p">)</span>
    <span class="c1"># ç¸½æ™‚é–“ï¼š200ms (æœ€æ…¢çš„é‚£å€‹)
</span></code></pre></div></div>

<h3 id="2-è³‡æ–™åº«æŸ¥è©¢å„ªåŒ–">2. è³‡æ–™åº«æŸ¥è©¢å„ªåŒ–</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># âŒ N+1 æŸ¥è©¢å•é¡Œ
</span><span class="k">async</span> <span class="k">def</span> <span class="nf">get_users_with_posts</span><span class="p">():</span>
    <span class="n">users</span> <span class="o">=</span> <span class="k">await</span> <span class="n">database</span><span class="p">.</span><span class="n">get_all_users</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">users</span><span class="p">:</span>
        <span class="n">user</span><span class="p">.</span><span class="n">posts</span> <span class="o">=</span> <span class="k">await</span> <span class="n">database</span><span class="p">.</span><span class="n">get_posts_by_user</span><span class="p">(</span><span class="n">user</span><span class="p">.</span><span class="nb">id</span><span class="p">)</span>  <span class="c1"># æ¯å€‹ç”¨æˆ¶ä¸€æ¬¡æŸ¥è©¢
</span>    <span class="k">return</span> <span class="n">users</span>

<span class="c1"># âœ… æ‰¹é‡æŸ¥è©¢
</span><span class="k">async</span> <span class="k">def</span> <span class="nf">get_users_with_posts_optimized</span><span class="p">():</span>
    <span class="n">users</span> <span class="o">=</span> <span class="k">await</span> <span class="n">database</span><span class="p">.</span><span class="n">get_all_users</span><span class="p">()</span>
    <span class="n">user_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">user</span><span class="p">.</span><span class="nb">id</span> <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">users</span><span class="p">]</span>
    <span class="n">all_posts</span> <span class="o">=</span> <span class="k">await</span> <span class="n">database</span><span class="p">.</span><span class="n">get_posts_by_user_ids</span><span class="p">(</span><span class="n">user_ids</span><span class="p">)</span>  <span class="c1"># ä¸€æ¬¡æŸ¥è©¢
</span>    
    <span class="c1"># åœ¨ç¨‹å¼ä¸­çµ„åˆè³‡æ–™
</span>    <span class="n">posts_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">post</span> <span class="ow">in</span> <span class="n">all_posts</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">post</span><span class="p">.</span><span class="n">user_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">posts_dict</span><span class="p">:</span>
            <span class="n">posts_dict</span><span class="p">[</span><span class="n">post</span><span class="p">.</span><span class="n">user_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">posts_dict</span><span class="p">[</span><span class="n">post</span><span class="p">.</span><span class="n">user_id</span><span class="p">].</span><span class="n">append</span><span class="p">(</span><span class="n">post</span><span class="p">)</span>
    
    <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">users</span><span class="p">:</span>
        <span class="n">user</span><span class="p">.</span><span class="n">posts</span> <span class="o">=</span> <span class="n">posts_dict</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">user</span><span class="p">.</span><span class="nb">id</span><span class="p">,</span> <span class="p">[])</span>
    
    <span class="k">return</span> <span class="n">users</span>
</code></pre></div></div>

<h3 id="3-å¿«å–ç­–ç•¥">3. å¿«å–ç­–ç•¥</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">wraps</span>
<span class="kn">import</span> <span class="nn">redis</span>
<span class="kn">import</span> <span class="nn">json</span>

<span class="n">redis_client</span> <span class="o">=</span> <span class="n">redis</span><span class="p">.</span><span class="n">Redis</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s">'localhost'</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">6379</span><span class="p">,</span> <span class="n">db</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">cache_result</span><span class="p">(</span><span class="n">expire_seconds</span><span class="o">=</span><span class="mi">300</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">decorator</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
        <span class="o">@</span><span class="n">wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
        <span class="k">async</span> <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="c1"># ç”¢ç”Ÿå¿«å– key
</span>            <span class="n">cache_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">func</span><span class="p">.</span><span class="n">__name__</span><span class="si">}</span><span class="s">:</span><span class="si">{</span><span class="nb">hash</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">kwargs</span><span class="p">))</span><span class="si">}</span><span class="s">"</span>
            
            <span class="c1"># å˜—è©¦å¾å¿«å–å–å¾—
</span>            <span class="n">cached</span> <span class="o">=</span> <span class="n">redis_client</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">cache_key</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">cached</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">json</span><span class="p">.</span><span class="n">loads</span><span class="p">(</span><span class="n">cached</span><span class="p">)</span>
            
            <span class="c1"># åŸ·è¡ŒåŸå‡½æ•¸
</span>            <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            
            <span class="c1"># å„²å­˜åˆ°å¿«å–
</span>            <span class="n">redis_client</span><span class="p">.</span><span class="n">setex</span><span class="p">(</span>
                <span class="n">cache_key</span><span class="p">,</span> 
                <span class="n">expire_seconds</span><span class="p">,</span> 
                <span class="n">json</span><span class="p">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>
            <span class="p">)</span>
            
            <span class="k">return</span> <span class="n">result</span>
        <span class="k">return</span> <span class="n">wrapper</span>
    <span class="k">return</span> <span class="n">decorator</span>

<span class="c1"># ä½¿ç”¨å¿«å–
</span><span class="o">@</span><span class="n">cache_result</span><span class="p">(</span><span class="n">expire_seconds</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>  <span class="c1"># å¿«å– 10 åˆ†é˜
</span><span class="k">async</span> <span class="k">def</span> <span class="nf">get_popular_articles</span><span class="p">():</span>
    <span class="k">return</span> <span class="k">await</span> <span class="n">database</span><span class="p">.</span><span class="n">get_articles_by_popularity</span><span class="p">()</span>
</code></pre></div></div>

<h2 id="å®‰å…¨æ€§è€ƒé‡-">å®‰å…¨æ€§è€ƒé‡ ğŸ”</h2>

<h3 id="1-è¼¸å…¥é©—è­‰èˆ‡-sql-injection-é˜²è­·">1. è¼¸å…¥é©—è­‰èˆ‡ SQL Injection é˜²è­·</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># âŒ å±éšªçš„åšæ³•
</span><span class="k">async</span> <span class="k">def</span> <span class="nf">get_user_by_email</span><span class="p">(</span><span class="n">email</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"SELECT * FROM users WHERE email = '</span><span class="si">{</span><span class="n">email</span><span class="si">}</span><span class="s">'"</span>  <span class="c1"># SQL Injection é¢¨éšª
</span>    <span class="k">return</span> <span class="k">await</span> <span class="n">database</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>

<span class="c1"># âœ… å®‰å…¨çš„åšæ³•
</span><span class="k">async</span> <span class="k">def</span> <span class="nf">get_user_by_email_safe</span><span class="p">(</span><span class="n">email</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="n">query</span> <span class="o">=</span> <span class="s">"SELECT * FROM users WHERE email = %s"</span>
    <span class="k">return</span> <span class="k">await</span> <span class="n">database</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">(</span><span class="n">email</span><span class="p">,))</span>  <span class="c1"># åƒæ•¸åŒ–æŸ¥è©¢
</span></code></pre></div></div>

<h3 id="2-é™æµèˆ‡-rate-limiting">2. é™æµèˆ‡ Rate Limiting</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">slowapi</span> <span class="kn">import</span> <span class="n">Limiter</span><span class="p">,</span> <span class="n">_rate_limit_exceeded_handler</span>
<span class="kn">from</span> <span class="nn">slowapi.util</span> <span class="kn">import</span> <span class="n">get_remote_address</span>
<span class="kn">from</span> <span class="nn">slowapi.errors</span> <span class="kn">import</span> <span class="n">RateLimitExceeded</span>

<span class="n">limiter</span> <span class="o">=</span> <span class="n">Limiter</span><span class="p">(</span><span class="n">key_func</span><span class="o">=</span><span class="n">get_remote_address</span><span class="p">)</span>
<span class="n">app</span><span class="p">.</span><span class="n">state</span><span class="p">.</span><span class="n">limiter</span> <span class="o">=</span> <span class="n">limiter</span>
<span class="n">app</span><span class="p">.</span><span class="n">add_exception_handler</span><span class="p">(</span><span class="n">RateLimitExceeded</span><span class="p">,</span> <span class="n">_rate_limit_exceeded_handler</span><span class="p">)</span>

<span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="s">"/login/"</span><span class="p">)</span>
<span class="o">@</span><span class="n">limiter</span><span class="p">.</span><span class="n">limit</span><span class="p">(</span><span class="s">"5/minute"</span><span class="p">)</span>  <span class="c1"># æ¯åˆ†é˜æœ€å¤š 5 æ¬¡ç™»å…¥å˜—è©¦
</span><span class="k">async</span> <span class="k">def</span> <span class="nf">login</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">,</span> <span class="n">credentials</span><span class="p">:</span> <span class="n">LoginCredentials</span><span class="p">):</span>
    <span class="c1"># ç™»å…¥é‚è¼¯
</span>    <span class="k">pass</span>
</code></pre></div></div>

<h2 id="api-æ–‡ä»¶èˆ‡æ¸¬è©¦-">API æ–‡ä»¶èˆ‡æ¸¬è©¦ ğŸ“š</h2>

<h3 id="è‡ªå‹•ç”Ÿæˆæ–‡ä»¶">è‡ªå‹•ç”Ÿæˆæ–‡ä»¶</h3>

<p>FastAPI çš„ä¸€å¤§å„ªå‹¢å°±æ˜¯è‡ªå‹•æ–‡ä»¶ç”Ÿæˆï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">fastapi</span> <span class="kn">import</span> <span class="n">FastAPI</span>
<span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="n">BaseModel</span><span class="p">,</span> <span class="n">Field</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">FastAPI</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s">"æˆ‘çš„è¶…æ£’ API"</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s">"é€™å€‹ API å¯ä»¥åšå¾ˆå¤šå¾ˆé…·çš„äº‹æƒ… ğŸš€"</span><span class="p">,</span>
    <span class="n">version</span><span class="o">=</span><span class="s">"1.0.0"</span>
<span class="p">)</span>

<span class="k">class</span> <span class="nc">UserResponse</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="nb">id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(...,</span> <span class="n">description</span><span class="o">=</span><span class="s">"ç”¨æˆ¶çš„å”¯ä¸€è­˜åˆ¥ç¢¼"</span><span class="p">)</span>
    <span class="n">username</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(...,</span> <span class="n">description</span><span class="o">=</span><span class="s">"ç”¨æˆ¶åç¨±"</span><span class="p">,</span> <span class="n">example</span><span class="o">=</span><span class="s">"john_doe"</span><span class="p">)</span>
    <span class="n">email</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(...,</span> <span class="n">description</span><span class="o">=</span><span class="s">"é›»å­éƒµä»¶åœ°å€"</span><span class="p">,</span> <span class="n">example</span><span class="o">=</span><span class="s">"john@example.com"</span><span class="p">)</span>
    <span class="n">created_at</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(...,</span> <span class="n">description</span><span class="o">=</span><span class="s">"å¸³è™Ÿå»ºç«‹æ™‚é–“"</span><span class="p">)</span>

<span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"/users/{user_id}"</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">UserResponse</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">get_user</span><span class="p">(</span>
    <span class="n">user_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(...,</span> <span class="n">description</span><span class="o">=</span><span class="s">"è¦æŸ¥è©¢çš„ç”¨æˆ¶ ID"</span><span class="p">,</span> <span class="n">example</span><span class="o">=</span><span class="mi">123</span><span class="p">)</span>
<span class="p">):</span>
    <span class="s">"""
    å–å¾—æŒ‡å®šç”¨æˆ¶çš„è©³ç´°è³‡è¨Š
    
    - **user_id**: ç”¨æˆ¶çš„å”¯ä¸€è­˜åˆ¥ç¢¼
    
    å›å‚³ç”¨æˆ¶çš„åŸºæœ¬è³‡æ–™ï¼ŒåŒ…æ‹¬ç”¨æˆ¶åç¨±ã€é›»å­éƒµä»¶ç­‰è³‡è¨Šã€‚
    """</span>
    <span class="c1"># å¯¦ä½œé‚è¼¯
</span>    <span class="k">pass</span>
</code></pre></div></div>

<p>è¨ªå• <code class="language-plaintext highlighter-rouge">http://localhost:8000/docs</code> å°±èƒ½çœ‹åˆ°ç¾ç¾çš„ Swagger UI æ–‡ä»¶ï¼</p>

<h3 id="å–®å…ƒæ¸¬è©¦">å–®å…ƒæ¸¬è©¦</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">fastapi.testclient</span> <span class="kn">import</span> <span class="n">TestClient</span>
<span class="kn">import</span> <span class="nn">pytest</span>

<span class="n">client</span> <span class="o">=</span> <span class="n">TestClient</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">test_create_user_success</span><span class="p">():</span>
    <span class="n">user_data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">"username"</span><span class="p">:</span> <span class="s">"testuser"</span><span class="p">,</span>
        <span class="s">"email"</span><span class="p">:</span> <span class="s">"test@example.com"</span><span class="p">,</span>
        <span class="s">"password"</span><span class="p">:</span> <span class="s">"SecurePass123"</span>
    <span class="p">}</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="s">"/users/"</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">user_data</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">response</span><span class="p">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">201</span>
    <span class="k">assert</span> <span class="n">response</span><span class="p">.</span><span class="n">json</span><span class="p">()[</span><span class="s">"success"</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">True</span>

<span class="k">def</span> <span class="nf">test_create_user_duplicate_username</span><span class="p">():</span>
    <span class="n">user_data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">"username"</span><span class="p">:</span> <span class="s">"existing_user"</span><span class="p">,</span> 
        <span class="s">"email"</span><span class="p">:</span> <span class="s">"test@example.com"</span><span class="p">,</span>
        <span class="s">"password"</span><span class="p">:</span> <span class="s">"SecurePass123"</span>
    <span class="p">}</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="s">"/users/"</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">user_data</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">response</span><span class="p">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">409</span>
    <span class="k">assert</span> <span class="s">"DUPLICATE_USERNAME"</span> <span class="ow">in</span> <span class="n">response</span><span class="p">.</span><span class="n">json</span><span class="p">()[</span><span class="s">"error_code"</span><span class="p">]</span>
</code></pre></div></div>

<h2 id="éƒ¨ç½²èˆ‡ç›£æ§-">éƒ¨ç½²èˆ‡ç›£æ§ ğŸ“Š</h2>

<h3 id="docker-åŒ–éƒ¨ç½²">Docker åŒ–éƒ¨ç½²</h3>

<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">FROM</span><span class="s"> python:3.11-slim</span>

<span class="k">WORKDIR</span><span class="s"> /app</span>

<span class="k">COPY</span><span class="s"> requirements.txt .</span>
<span class="k">RUN </span>pip <span class="nb">install</span> <span class="nt">--no-cache-dir</span> <span class="nt">-r</span> requirements.txt

<span class="k">COPY</span><span class="s"> . .</span>

<span class="k">EXPOSE</span><span class="s"> 8000</span>

<span class="k">CMD</span><span class="s"> ["uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8000"]</span>
</code></pre></div></div>

<h3 id="æ—¥èªŒèˆ‡ç›£æ§">æ—¥èªŒèˆ‡ç›£æ§</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">fastapi</span> <span class="kn">import</span> <span class="n">Request</span>

<span class="c1"># è¨­å®šæ—¥èªŒ
</span><span class="n">logging</span><span class="p">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="p">.</span><span class="n">INFO</span><span class="p">)</span>
<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="p">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>

<span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">middleware</span><span class="p">(</span><span class="s">"http"</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">log_requests</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">,</span> <span class="n">call_next</span><span class="p">):</span>
    <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span>
    
    <span class="c1"># è¨˜éŒ„è«‹æ±‚
</span>    <span class="n">logger</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s">"è«‹æ±‚é–‹å§‹: </span><span class="si">{</span><span class="n">request</span><span class="p">.</span><span class="n">method</span><span class="si">}</span><span class="s"> </span><span class="si">{</span><span class="n">request</span><span class="p">.</span><span class="n">url</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
    
    <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">call_next</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
    
    <span class="c1"># è¨ˆç®—è™•ç†æ™‚é–“
</span>    <span class="n">process_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
    
    <span class="c1"># è¨˜éŒ„å›æ‡‰
</span>    <span class="n">logger</span><span class="p">.</span><span class="n">info</span><span class="p">(</span>
        <span class="sa">f</span><span class="s">"è«‹æ±‚å®Œæˆ: </span><span class="si">{</span><span class="n">request</span><span class="p">.</span><span class="n">method</span><span class="si">}</span><span class="s"> </span><span class="si">{</span><span class="n">request</span><span class="p">.</span><span class="n">url</span><span class="si">}</span><span class="s"> "</span>
        <span class="sa">f</span><span class="s">"ç‹€æ…‹ç¢¼: </span><span class="si">{</span><span class="n">response</span><span class="p">.</span><span class="n">status_code</span><span class="si">}</span><span class="s"> "</span>
        <span class="sa">f</span><span class="s">"è™•ç†æ™‚é–“: </span><span class="si">{</span><span class="n">process_time</span><span class="si">:</span><span class="p">.</span><span class="mi">4</span><span class="n">f</span><span class="si">}</span><span class="s">s"</span>
    <span class="p">)</span>
    
    <span class="k">return</span> <span class="n">response</span>
</code></pre></div></div>

<h2 id="æˆ‘çš„è¸©å‘ç¶“é©—åˆ†äº«-">æˆ‘çš„è¸©å‘ç¶“é©—åˆ†äº« ğŸ’€</h2>

<h3 id="1-è³‡æ–™åº«é€£ç·šæ± æ²’è¨­å®šå¥½">1. è³‡æ–™åº«é€£ç·šæ± æ²’è¨­å®šå¥½</h3>

<p>æœ‰æ¬¡éƒ¨ç½²åˆ°ç”Ÿç”¢ç’°å¢ƒå¾Œï¼ŒAPI åœ¨é«˜æµé‡æ™‚æœƒéš¨æ©Ÿå›å‚³ 500 éŒ¯èª¤ã€‚èª¿æŸ¥å¾Œç™¼ç¾æ˜¯è³‡æ–™åº«é€£ç·šæ± è¨­å®šå¤ªå°ï¼Œå°è‡´é€£ç·šä¸è¶³ ğŸ¤¦â€â™‚ï¸</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># âŒ æ²’è¨­å®šé€£ç·šæ± 
</span><span class="n">engine</span> <span class="o">=</span> <span class="n">create_async_engine</span><span class="p">(</span><span class="s">"postgresql://..."</span><span class="p">)</span>

<span class="c1"># âœ… æ­£ç¢ºè¨­å®š
</span><span class="n">engine</span> <span class="o">=</span> <span class="n">create_async_engine</span><span class="p">(</span>
    <span class="s">"postgresql://..."</span><span class="p">,</span>
    <span class="n">pool_size</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>           <span class="c1"># åŸºæœ¬é€£ç·šæ•¸
</span>    <span class="n">max_overflow</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>        <span class="c1"># æœ€å¤§é¡å¤–é€£ç·šæ•¸
</span>    <span class="n">pool_timeout</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>        <span class="c1"># å–å¾—é€£ç·šçš„è¶…æ™‚æ™‚é–“
</span>    <span class="n">pool_recycle</span><span class="o">=</span><span class="mi">3600</span>       <span class="c1"># é€£ç·šå›æ”¶æ™‚é–“
</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="2-å¿˜è¨˜è™•ç†æ™‚å€å•é¡Œ">2. å¿˜è¨˜è™•ç†æ™‚å€å•é¡Œ</h3>

<p>å¦ä¸€å€‹æ…˜ç—›ç¶“é©—æ˜¯æ™‚å€å•é¡Œã€‚API å›å‚³çš„æ™‚é–“åœ¨ä¸åŒåœ°å€çš„ç”¨æˆ¶çœ‹åˆ°çš„ä¸ä¸€æ¨£ ğŸ˜µ</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timezone</span>

<span class="c1"># âŒ æ²’è€ƒæ…®æ™‚å€
</span><span class="n">created_at</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">.</span><span class="n">now</span><span class="p">()</span>  <span class="c1"># é€™æ˜¯ server çš„ç•¶åœ°æ™‚é–“
</span>
<span class="c1"># âœ… æ˜ç¢ºä½¿ç”¨ UTC
</span><span class="n">created_at</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="p">.</span><span class="n">utc</span><span class="p">)</span>  <span class="c1"># çµ±ä¸€ç”¨ UTC
</span></code></pre></div></div>

<h2 id="ç¸½çµèˆ‡å»ºè­°-">ç¸½çµèˆ‡å»ºè­° ğŸ¯</h2>

<p>è¨­è¨ˆä¸€å€‹å¥½çš„ API çœŸçš„æ˜¯é–€è—è¡“ï¼Œéœ€è¦åœ¨å¾ˆå¤šé¢å‘å–å¾—å¹³è¡¡ï¼š</p>

<ol>
  <li><strong>æ•ˆèƒ½ vs å¯è®€æ€§</strong> - ä¸è¦éåº¦å„ªåŒ–ï¼Œä¿æŒç¨‹å¼ç¢¼ç°¡æ½”</li>
  <li><strong>åŠŸèƒ½å®Œæ•´ vs ç°¡æ½”</strong> - API è¨­è¨ˆè¦ç°¡å–®æ˜ç­ï¼Œä¸è¦å¡å¤ªå¤šåŠŸèƒ½</li>
  <li><strong>å½ˆæ€§ vs ç©©å®š</strong> - ç‰ˆæœ¬æ§åˆ¶å¾ˆé‡è¦ï¼Œå‘å¾Œç›¸å®¹æ€§è¦è€ƒæ…®</li>
</ol>

<h3 id="æˆ‘çš„é–‹ç™¼æµç¨‹å»ºè­°">æˆ‘çš„é–‹ç™¼æµç¨‹å»ºè­°ï¼š</h3>
<ol>
  <li>ğŸ“‹ <strong>éœ€æ±‚åˆ†æ</strong> - å…ˆææ¸…æ¥šè¦è§£æ±ºä»€éº¼å•é¡Œ</li>
  <li>ğŸ¨ <strong>API è¨­è¨ˆ</strong> - è¨­è¨ˆ URL çµæ§‹å’Œè³‡æ–™æ ¼å¼</li>
  <li>ğŸ“ <strong>å¯«æ¸¬è©¦</strong> - å…ˆå¯«æ¸¬è©¦å†å¯«å¯¦ä½œï¼ˆTDDï¼‰</li>
  <li>ğŸ’» <strong>å¯¦ä½œåŠŸèƒ½</strong> - ä¸€å€‹ä¸€å€‹ endpoint æ…¢æ…¢å¯¦ä½œ</li>
  <li>ğŸ“š <strong>å¯«æ–‡ä»¶</strong> - FastAPI è‡ªå‹•ç”Ÿæˆï¼Œä½†é‚„æ˜¯è¦è£œå……èªªæ˜</li>
  <li>ğŸš€ <strong>éƒ¨ç½²æ¸¬è©¦</strong> - åœ¨é¡ç”Ÿç”¢ç’°å¢ƒæ¸¬è©¦</li>
</ol>

<p>è¨˜ä½ï¼Œ<strong>å¥½çš„ API å°±åƒå¥½çš„å·¥å…·ï¼Œä½¿ç”¨è€…ç”šè‡³ä¸æœƒæ³¨æ„åˆ°å®ƒçš„å­˜åœ¨</strong> - å®ƒå°±æ˜¯èƒ½å®Œç¾åœ°å®Œæˆå·¥ä½œï¼</p>

<hr />

<h2 id="å»¶ä¼¸é–±è®€-">å»¶ä¼¸é–±è®€ ğŸ“–</h2>

<p>æƒ³æ·±å…¥äº†è§£ API è¨­è¨ˆçš„è©±ï¼Œæ¨è–¦é€™äº›è³‡æºï¼š</p>

<ul>
  <li>ğŸ“– <a href="https://www.oreilly.com/library/view/restful-web-apis/9781449359713/">RESTful Web APIs</a> - API è¨­è¨ˆè–ç¶“</li>
  <li>ğŸŒ <a href="https://fastapi.tiangolo.com/">FastAPI å®˜æ–¹æ–‡ä»¶</a> - å¯«å¾—éå¸¸è©³ç´°</li>
  <li>ğŸ“ <a href="https://github.com/Microsoft/api-guidelines">Microsoft REST API Guidelines</a> - å¾®è»Ÿçš„ API è¨­è¨ˆæŒ‡å—</li>
</ul>

<p>ä¸‹æ¬¡æˆ‘å€‘ä¾†èŠèŠå¾®æœå‹™æ¶æ§‹çš„è¨­è¨ˆï¼Œé‚£åˆæ˜¯å¦ä¸€å€‹å¤§å‘äº† ğŸ˜…</p>

<p>æœ‰å•é¡Œæ­¡è¿åœ¨åº•ä¸‹ç•™è¨€è¨è«–ï¼Œæˆ–æ˜¯ç›´æ¥ Email çµ¦æˆ‘ï¼Happy coding! ğŸš€</p>]]></content><author><name>Archi Chen</name><email>magic83w@gmail.com</email></author><category term="backend" /><category term="technical" /><category term="Python" /><category term="FastAPI" /><category term="APIè¨­è¨ˆ" /><category term="å¾Œç«¯é–‹ç™¼" /><category term="æœ€ä½³å¯¦å‹™" /><summary type="html"><![CDATA[è¨­è¨ˆä¸€å€‹å¥½çš„ API å°±åƒåšæ–™ç†ä¸€æ¨£ï¼Œé£Ÿæï¼ˆç¨‹å¼ç¢¼ï¼‰å¾ˆé‡è¦ï¼Œä½†èª¿å‘³ï¼ˆè¨­è¨ˆåŸå‰‡ï¼‰æ›´é—œéµï¼ä»Šå¤©ä¾†èŠèŠ Python Backend API çš„è¨­è¨ˆæ’‡æ­¥ ğŸ‘¨â€ğŸ³]]></summary></entry><entry><title type="html">Pandas æ•ˆèƒ½èª¿æ ¡ï¼šè®“ä½ çš„è³‡æ–™åˆ†æé£›èµ·ä¾†ï¼</title><link href="https://magicxcr7.github.io/data-science/technical/pandas-performance-optimization-tips/" rel="alternate" type="text/html" title="Pandas æ•ˆèƒ½èª¿æ ¡ï¼šè®“ä½ çš„è³‡æ–™åˆ†æé£›èµ·ä¾†ï¼" /><published>2024-12-17T09:15:00+08:00</published><updated>2024-12-17T09:15:00+08:00</updated><id>https://magicxcr7.github.io/data-science/technical/pandas-performance-optimization-tips</id><content type="html" xml:base="https://magicxcr7.github.io/data-science/technical/pandas-performance-optimization-tips/"><![CDATA[<p>å‰å¹¾å¤©åŒäº‹è·‘ä¾†å•æˆ‘ï¼šã€Œç‚ºä»€éº¼æˆ‘çš„ Pandas ç¨‹å¼è·‘äº† 2 å°æ™‚é‚„æ²’çµæŸï¼Ÿã€çœ‹äº†ä¸€ä¸‹ä»–çš„ç¨‹å¼ç¢¼ï¼Œæˆ‘å·®é»ç¬‘å‡ºä¾†â€¦ ğŸ˜…</p>

<p>å…¶å¯¦ Pandas æ•ˆèƒ½å„ªåŒ–å°±åƒèª¿éŸ³éŸ¿ä¸€æ¨£ï¼ŒçŸ¥é“å¹¾å€‹é—œéµçš„ã€Œæ—‹éˆ•ã€åœ¨å“ªè£¡ï¼Œå°±èƒ½è®“å®ƒå”±å‡ºç¾å¦™çš„æ­Œè²ï¼ä»Šå¤©å°±ä¾†åˆ†äº«ä¸€äº›æˆ‘é€™å¹¾å¹´è¸©å‘ç´¯ç©çš„å„ªåŒ–æŠ€å·§ã€‚</p>

<!--more-->

<h2 id="ç‚ºä»€éº¼-pandas-æœƒé€™éº¼æ…¢-">ç‚ºä»€éº¼ Pandas æœƒé€™éº¼æ…¢ï¼Ÿ ğŸ¤”</h2>

<p>é¦–å…ˆè¦äº†è§£ Pandas çš„ã€Œç—›é»ã€åœ¨å“ªè£¡ï¼š</p>

<h3 id="1-è¨˜æ†¶é«”ä½¿ç”¨ä¸ç•¶">1. è¨˜æ†¶é«”ä½¿ç”¨ä¸ç•¶</h3>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>

<span class="c1"># ç”¢ç”Ÿæ¸¬è©¦è³‡æ–™
</span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s">'id'</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000000</span><span class="p">),</span>
    <span class="s">'value'</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1000000</span><span class="p">)</span>
<span class="p">})</span>

<span class="c1"># æª¢æŸ¥è¨˜æ†¶é«”ä½¿ç”¨
</span><span class="k">print</span><span class="p">(</span><span class="n">df</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="n">memory_usage</span><span class="o">=</span><span class="s">'deep'</span><span class="p">))</span>
</code></pre></div></div>

<h3 id="2-è¿´åœˆçš„é™·é˜±">2. è¿´åœˆçš„é™·é˜±</h3>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># âŒ é€™æ¨£å¯«æœƒè¢«åŒäº‹ç¿»ç™½çœ¼...
</span><span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df</span><span class="p">.</span><span class="n">iterrows</span><span class="p">():</span>  <span class="c1"># è¶…ç´šæ…¢ï¼
</span>    <span class="n">total</span> <span class="o">+=</span> <span class="n">row</span><span class="p">[</span><span class="s">'value'</span><span class="p">]</span>

<span class="c1"># âœ… å‘é‡åŒ–æ“ä½œ
</span><span class="n">total</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s">'value'</span><span class="p">].</span><span class="nb">sum</span><span class="p">()</span>  <span class="c1"># å¿« 100 å€ï¼
</span></code></pre></div></div>

<p>è®“æˆ‘ç”¨å¯¦éš›æ¸¬è©¦ä¾†å±•ç¤ºå·®ç•°ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">time</span>

<span class="k">def</span> <span class="nf">time_it</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">func</span><span class="p">()</span>
    <span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"åŸ·è¡Œæ™‚é–“: </span><span class="si">{</span><span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="si">:</span><span class="p">.</span><span class="mi">4</span><span class="n">f</span><span class="si">}</span><span class="s"> ç§’"</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>

<span class="c1"># æ¸¬è©¦è³‡æ–™
</span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s">'A'</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">100000</span><span class="p">),</span>
    <span class="s">'B'</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">100000</span><span class="p">)</span>
<span class="p">})</span>

<span class="c1"># æ–¹æ³• 1: è¿´åœˆ (æ…¢åˆ°çˆ†)
</span><span class="k">def</span> <span class="nf">loop_method</span><span class="p">():</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df</span><span class="p">.</span><span class="n">iterrows</span><span class="p">():</span>
        <span class="n">result</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s">'A'</span><span class="p">]</span> <span class="o">+</span> <span class="n">row</span><span class="p">[</span><span class="s">'B'</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">result</span>

<span class="c1"># æ–¹æ³• 2: å‘é‡åŒ–æ“ä½œ (ç¥é€Ÿ)
</span><span class="k">def</span> <span class="nf">vectorized_method</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">df</span><span class="p">[</span><span class="s">'A'</span><span class="p">]</span> <span class="o">+</span> <span class="n">df</span><span class="p">[</span><span class="s">'B'</span><span class="p">]</span>

<span class="k">print</span><span class="p">(</span><span class="s">"è¿´åœˆæ–¹æ³•:"</span><span class="p">)</span>
<span class="n">time_it</span><span class="p">(</span><span class="n">loop_method</span><span class="p">)</span>        <span class="c1"># ~15 ç§’
</span>
<span class="k">print</span><span class="p">(</span><span class="s">"å‘é‡åŒ–æ–¹æ³•:"</span><span class="p">)</span>
<span class="n">time_it</span><span class="p">(</span><span class="n">vectorized_method</span><span class="p">)</span>  <span class="c1"># ~0.001 ç§’
</span></code></pre></div></div>

<p>å·®ç•°æœ‰å¤šå¤§ï¼Ÿå‘é‡åŒ–æ“ä½œå¯ä»¥å¿«ä¸Š <strong>15,000 å€</strong>ï¼ğŸ˜±</p>

<h2 id="è³‡æ–™é¡å‹å„ªåŒ–çœè¨˜æ†¶é«”å°±æ˜¯çœæ™‚é–“-">è³‡æ–™é¡å‹å„ªåŒ–ï¼šçœè¨˜æ†¶é«”å°±æ˜¯çœæ™‚é–“ ğŸ’¾</h2>

<h3 id="é¸å°è³‡æ–™é¡å‹">é¸å°è³‡æ–™é¡å‹</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># å»ºç«‹æ¸¬è©¦ DataFrame
</span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s">'int_col'</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">1000000</span><span class="p">),</span>
    <span class="s">'float_col'</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1000000</span><span class="p">),</span>
    <span class="s">'str_col'</span><span class="p">:</span> <span class="p">[</span><span class="s">'category_'</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span> <span class="o">%</span> <span class="mi">10</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000000</span><span class="p">)]</span>
<span class="p">})</span>

<span class="k">print</span><span class="p">(</span><span class="s">"åŸå§‹è³‡æ–™é¡å‹:"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">df</span><span class="p">.</span><span class="n">dtypes</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"è¨˜æ†¶é«”ä½¿ç”¨: </span><span class="si">{</span><span class="n">df</span><span class="p">.</span><span class="n">memory_usage</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="bp">True</span><span class="p">).</span><span class="nb">sum</span><span class="p">()</span> <span class="o">/</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">2</span><span class="si">:</span><span class="p">.</span><span class="mi">2</span><span class="n">f</span><span class="si">}</span><span class="s"> MB"</span><span class="p">)</span>

<span class="c1"># å„ªåŒ–è³‡æ–™é¡å‹
</span><span class="n">df_optimized</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="n">copy</span><span class="p">()</span>

<span class="c1"># int64 -&gt; int8 (å¦‚æœæ•¸å€¼ç¯„åœå…è¨±)
</span><span class="n">df_optimized</span><span class="p">[</span><span class="s">'int_col'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_optimized</span><span class="p">[</span><span class="s">'int_col'</span><span class="p">].</span><span class="n">astype</span><span class="p">(</span><span class="s">'int8'</span><span class="p">)</span>

<span class="c1"># float64 -&gt; float32 (é€šå¸¸ç²¾åº¦å¤ ç”¨)
</span><span class="n">df_optimized</span><span class="p">[</span><span class="s">'float_col'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_optimized</span><span class="p">[</span><span class="s">'float_col'</span><span class="p">].</span><span class="n">astype</span><span class="p">(</span><span class="s">'float32'</span><span class="p">)</span>

<span class="c1"># å­—ä¸² -&gt; category (é‡è¤‡å€¼å¾ˆå¤šæ™‚è¶…æœ‰æ•ˆ)
</span><span class="n">df_optimized</span><span class="p">[</span><span class="s">'str_col'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_optimized</span><span class="p">[</span><span class="s">'str_col'</span><span class="p">].</span><span class="n">astype</span><span class="p">(</span><span class="s">'category'</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">å„ªåŒ–å¾Œè³‡æ–™é¡å‹:"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">df_optimized</span><span class="p">.</span><span class="n">dtypes</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"è¨˜æ†¶é«”ä½¿ç”¨: </span><span class="si">{</span><span class="n">df_optimized</span><span class="p">.</span><span class="n">memory_usage</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="bp">True</span><span class="p">).</span><span class="nb">sum</span><span class="p">()</span> <span class="o">/</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">2</span><span class="si">:</span><span class="p">.</span><span class="mi">2</span><span class="n">f</span><span class="si">}</span><span class="s"> MB"</span><span class="p">)</span>
</code></pre></div></div>

<p>çµæœé€šå¸¸èƒ½çœä¸‹ <strong>50-70%</strong> çš„è¨˜æ†¶é«”ï¼</p>

<h3 id="è‡ªå‹•å„ªåŒ–å‡½æ•¸">è‡ªå‹•å„ªåŒ–å‡½æ•¸</h3>

<p>æˆ‘å¯«äº†ä¸€å€‹è‡ªå‹•å„ªåŒ–çš„å‡½æ•¸ï¼Œè¶…å¥½ç”¨çš„ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">optimize_dtypes</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="s">"""è‡ªå‹•å„ªåŒ– DataFrame çš„è³‡æ–™é¡å‹"""</span>
    <span class="n">optimized</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="n">copy</span><span class="p">()</span>
    
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="p">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">col_type</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">].</span><span class="n">dtype</span>
        
        <span class="k">if</span> <span class="n">col_type</span> <span class="o">!=</span> <span class="s">'object'</span><span class="p">:</span>
            <span class="n">c_min</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">].</span><span class="nb">min</span><span class="p">()</span>
            <span class="n">c_max</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">].</span><span class="nb">max</span><span class="p">()</span>
            
            <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">col_type</span><span class="p">)[:</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s">'int'</span><span class="p">:</span>
                <span class="c1"># æ•´æ•¸å‹å„ªåŒ–
</span>                <span class="k">if</span> <span class="n">c_min</span> <span class="o">&gt;</span> <span class="n">np</span><span class="p">.</span><span class="n">iinfo</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">int8</span><span class="p">).</span><span class="nb">min</span> <span class="ow">and</span> <span class="n">c_max</span> <span class="o">&lt;</span> <span class="n">np</span><span class="p">.</span><span class="n">iinfo</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">int8</span><span class="p">).</span><span class="nb">max</span><span class="p">:</span>
                    <span class="n">optimized</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">].</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">int8</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">c_min</span> <span class="o">&gt;</span> <span class="n">np</span><span class="p">.</span><span class="n">iinfo</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">int16</span><span class="p">).</span><span class="nb">min</span> <span class="ow">and</span> <span class="n">c_max</span> <span class="o">&lt;</span> <span class="n">np</span><span class="p">.</span><span class="n">iinfo</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">int16</span><span class="p">).</span><span class="nb">max</span><span class="p">:</span>
                    <span class="n">optimized</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">].</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">int16</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">c_min</span> <span class="o">&gt;</span> <span class="n">np</span><span class="p">.</span><span class="n">iinfo</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">int32</span><span class="p">).</span><span class="nb">min</span> <span class="ow">and</span> <span class="n">c_max</span> <span class="o">&lt;</span> <span class="n">np</span><span class="p">.</span><span class="n">iinfo</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">int32</span><span class="p">).</span><span class="nb">max</span><span class="p">:</span>
                    <span class="n">optimized</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">].</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">int32</span><span class="p">)</span>
                    
            <span class="k">elif</span> <span class="nb">str</span><span class="p">(</span><span class="n">col_type</span><span class="p">)[:</span><span class="mi">5</span><span class="p">]</span> <span class="o">==</span> <span class="s">'float'</span><span class="p">:</span>
                <span class="c1"># æµ®é»æ•¸å„ªåŒ–
</span>                <span class="k">if</span> <span class="n">c_min</span> <span class="o">&gt;</span> <span class="n">np</span><span class="p">.</span><span class="n">finfo</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">float32</span><span class="p">).</span><span class="nb">min</span> <span class="ow">and</span> <span class="n">c_max</span> <span class="o">&lt;</span> <span class="n">np</span><span class="p">.</span><span class="n">finfo</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">float32</span><span class="p">).</span><span class="nb">max</span><span class="p">:</span>
                    <span class="n">optimized</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">].</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># å­—ä¸²é¡å‹å„ªåŒ–
</span>            <span class="n">num_unique_values</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">].</span><span class="n">unique</span><span class="p">())</span>
            <span class="n">num_total_values</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">num_unique_values</span> <span class="o">/</span> <span class="n">num_total_values</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">:</span>  <span class="c1"># é‡è¤‡ç‡è¶…é 50%
</span>                <span class="n">optimized</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">].</span><span class="n">astype</span><span class="p">(</span><span class="s">'category'</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">optimized</span>

<span class="c1"># ä½¿ç”¨ç¯„ä¾‹
</span><span class="n">df_auto_optimized</span> <span class="o">=</span> <span class="n">optimize_dtypes</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="è®€å–è³‡æ–™çš„å„ªåŒ–æŠ€å·§-">è®€å–è³‡æ–™çš„å„ªåŒ–æŠ€å·§ ğŸ“‚</h2>

<h3 id="csv-è®€å–å„ªåŒ–">CSV è®€å–å„ªåŒ–</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># âŒ æ…¢é€Ÿè®€å–
</span><span class="n">df_slow</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">'large_file.csv'</span><span class="p">)</span>

<span class="c1"># âœ… å„ªåŒ–è®€å–
</span><span class="n">df_fast</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span>
    <span class="s">'large_file.csv'</span><span class="p">,</span>
    <span class="n">dtype</span><span class="o">=</span><span class="p">{</span><span class="s">'user_id'</span><span class="p">:</span> <span class="s">'int32'</span><span class="p">,</span> <span class="s">'category'</span><span class="p">:</span> <span class="s">'category'</span><span class="p">},</span>  <span class="c1"># é å…ˆæŒ‡å®šå‹åˆ¥
</span>    <span class="n">parse_dates</span><span class="o">=</span><span class="p">[</span><span class="s">'timestamp'</span><span class="p">],</span>  <span class="c1"># æŒ‡å®šæ—¥æœŸæ¬„ä½
</span>    <span class="n">nrows</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span>  <span class="c1"># å…ˆè®€ä¸€éƒ¨åˆ†æ¸¬è©¦
</span>    <span class="n">chunksize</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span>  <span class="c1"># åˆ†æ‰¹è®€å–
</span>    <span class="n">low_memory</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>  <span class="c1"># é¿å…æ··åˆå‹åˆ¥æ¨æ–·
</span>    <span class="n">engine</span><span class="o">=</span><span class="s">'c'</span>  <span class="c1"># ä½¿ç”¨ C å¼•æ“ (é è¨­)
</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="åˆ†æ‰¹è™•ç†å¤§æª”æ¡ˆ">åˆ†æ‰¹è™•ç†å¤§æª”æ¡ˆ</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">process_large_csv</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">chunk_size</span><span class="o">=</span><span class="mi">10000</span><span class="p">):</span>
    <span class="s">"""åˆ†æ‰¹è™•ç†å¤§å‹ CSV æª”æ¡ˆ"""</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">chunksize</span><span class="o">=</span><span class="n">chunk_size</span><span class="p">):</span>
        <span class="c1"># å°æ¯å€‹ chunk é€²è¡Œè™•ç†
</span>        <span class="n">processed_chunk</span> <span class="o">=</span> <span class="n">chunk</span><span class="p">.</span><span class="n">groupby</span><span class="p">(</span><span class="s">'category'</span><span class="p">).</span><span class="nb">sum</span><span class="p">()</span>
        <span class="n">results</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">processed_chunk</span><span class="p">)</span>
    
    <span class="c1"># åˆä½µæ‰€æœ‰çµæœ
</span>    <span class="n">final_result</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">concat</span><span class="p">(</span><span class="n">results</span><span class="p">).</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">).</span><span class="nb">sum</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">final_result</span>

<span class="c1"># ä½¿ç”¨ç¯„ä¾‹
</span><span class="n">result</span> <span class="o">=</span> <span class="n">process_large_csv</span><span class="p">(</span><span class="s">'huge_sales_data.csv'</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="å‘é‡åŒ–æ“ä½œæ‹’çµ•è¿´åœˆçš„èª˜æƒ‘-">å‘é‡åŒ–æ“ä½œï¼šæ‹’çµ•è¿´åœˆçš„èª˜æƒ‘ ğŸš€</h2>

<h3 id="apply-vs-å‘é‡åŒ–æ“ä½œ">apply() vs å‘é‡åŒ–æ“ä½œ</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># æ¸¬è©¦è³‡æ–™
</span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s">'A'</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">100000</span><span class="p">),</span>
    <span class="s">'B'</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">100000</span><span class="p">),</span>
    <span class="s">'C'</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">choice</span><span class="p">([</span><span class="s">'X'</span><span class="p">,</span> <span class="s">'Y'</span><span class="p">,</span> <span class="s">'Z'</span><span class="p">],</span> <span class="mi">100000</span><span class="p">)</span>
<span class="p">})</span>

<span class="c1"># âŒ ä½¿ç”¨ apply (è¼ƒæ…¢)
</span><span class="k">def</span> <span class="nf">slow_calculation</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s">'C'</span><span class="p">]</span> <span class="o">==</span> <span class="s">'X'</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">row</span><span class="p">[</span><span class="s">'A'</span><span class="p">]</span> <span class="o">+</span> <span class="n">row</span><span class="p">[</span><span class="s">'B'</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">row</span><span class="p">[</span><span class="s">'C'</span><span class="p">]</span> <span class="o">==</span> <span class="s">'Y'</span><span class="p">:</span> 
        <span class="k">return</span> <span class="n">row</span><span class="p">[</span><span class="s">'A'</span><span class="p">]</span> <span class="o">-</span> <span class="n">row</span><span class="p">[</span><span class="s">'B'</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">row</span><span class="p">[</span><span class="s">'A'</span><span class="p">]</span> <span class="o">*</span> <span class="n">row</span><span class="p">[</span><span class="s">'B'</span><span class="p">]</span>

<span class="n">df</span><span class="p">[</span><span class="s">'result_slow'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="nb">apply</span><span class="p">(</span><span class="n">slow_calculation</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># âœ… å‘é‡åŒ–æ“ä½œ (è¶…å¿«)
</span><span class="n">conditions</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">df</span><span class="p">[</span><span class="s">'C'</span><span class="p">]</span> <span class="o">==</span> <span class="s">'X'</span><span class="p">,</span>
    <span class="n">df</span><span class="p">[</span><span class="s">'C'</span><span class="p">]</span> <span class="o">==</span> <span class="s">'Y'</span><span class="p">,</span>
    <span class="n">df</span><span class="p">[</span><span class="s">'C'</span><span class="p">]</span> <span class="o">==</span> <span class="s">'Z'</span>
<span class="p">]</span>

<span class="n">choices</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">df</span><span class="p">[</span><span class="s">'A'</span><span class="p">]</span> <span class="o">+</span> <span class="n">df</span><span class="p">[</span><span class="s">'B'</span><span class="p">],</span>
    <span class="n">df</span><span class="p">[</span><span class="s">'A'</span><span class="p">]</span> <span class="o">-</span> <span class="n">df</span><span class="p">[</span><span class="s">'B'</span><span class="p">],</span> 
    <span class="n">df</span><span class="p">[</span><span class="s">'A'</span><span class="p">]</span> <span class="o">*</span> <span class="n">df</span><span class="p">[</span><span class="s">'B'</span><span class="p">]</span>
<span class="p">]</span>

<span class="n">df</span><span class="p">[</span><span class="s">'result_fast'</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">select</span><span class="p">(</span><span class="n">conditions</span><span class="p">,</span> <span class="n">choices</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="å­—ä¸²æ“ä½œå„ªåŒ–">å­—ä¸²æ“ä½œå„ªåŒ–</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># âŒ æ…¢é€Ÿå­—ä¸²è™•ç†
</span><span class="n">df</span><span class="p">[</span><span class="s">'processed'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s">'text_col'</span><span class="p">].</span><span class="nb">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">.</span><span class="n">upper</span><span class="p">().</span><span class="n">strip</span><span class="p">())</span>

<span class="c1"># âœ… å‘é‡åŒ–å­—ä¸²æ“ä½œ
</span><span class="n">df</span><span class="p">[</span><span class="s">'processed'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s">'text_col'</span><span class="p">].</span><span class="nb">str</span><span class="p">.</span><span class="n">upper</span><span class="p">().</span><span class="nb">str</span><span class="p">.</span><span class="n">strip</span><span class="p">()</span>

<span class="c1"># æ›´è¤‡é›œçš„ä¾‹å­ï¼šæå– email ç¶²åŸŸ
# âŒ æ…¢é€Ÿç‰ˆæœ¬
</span><span class="n">df</span><span class="p">[</span><span class="s">'domain'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s">'email'</span><span class="p">].</span><span class="nb">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">'@'</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="s">'@'</span> <span class="ow">in</span> <span class="n">x</span> <span class="k">else</span> <span class="s">''</span><span class="p">)</span>

<span class="c1"># âœ… å¿«é€Ÿç‰ˆæœ¬
</span><span class="n">df</span><span class="p">[</span><span class="s">'domain'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s">'email'</span><span class="p">].</span><span class="nb">str</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">'@'</span><span class="p">).</span><span class="nb">str</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">fillna</span><span class="p">(</span><span class="s">''</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="ç¾¤çµ„æ“ä½œå„ªåŒ–-">ç¾¤çµ„æ“ä½œå„ªåŒ– ğŸ“Š</h2>

<h3 id="groupby-æ•ˆèƒ½èª¿æ ¡">GroupBy æ•ˆèƒ½èª¿æ ¡</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># æ¸¬è©¦è³‡æ–™
</span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s">'group'</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">choice</span><span class="p">([</span><span class="s">'A'</span><span class="p">,</span> <span class="s">'B'</span><span class="p">,</span> <span class="s">'C'</span><span class="p">],</span> <span class="mi">1000000</span><span class="p">),</span>
    <span class="s">'value1'</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1000000</span><span class="p">),</span>
    <span class="s">'value2'</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1000000</span><span class="p">),</span>
    <span class="s">'date'</span><span class="p">:</span> <span class="n">pd</span><span class="p">.</span><span class="n">date_range</span><span class="p">(</span><span class="s">'2020-01-01'</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">1000000</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s">'1min'</span><span class="p">)</span>
<span class="p">})</span>

<span class="c1"># âŒ æ…¢é€Ÿç¾¤çµ„æ“ä½œ
</span><span class="k">def</span> <span class="nf">slow_groupby</span><span class="p">():</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">df</span><span class="p">[</span><span class="s">'group'</span><span class="p">].</span><span class="n">unique</span><span class="p">():</span>
        <span class="n">subset</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s">'group'</span><span class="p">]</span> <span class="o">==</span> <span class="n">group</span><span class="p">]</span>
        <span class="n">agg_result</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">'group'</span><span class="p">:</span> <span class="n">group</span><span class="p">,</span>
            <span class="s">'mean_value1'</span><span class="p">:</span> <span class="n">subset</span><span class="p">[</span><span class="s">'value1'</span><span class="p">].</span><span class="n">mean</span><span class="p">(),</span>
            <span class="s">'sum_value2'</span><span class="p">:</span> <span class="n">subset</span><span class="p">[</span><span class="s">'value2'</span><span class="p">].</span><span class="nb">sum</span><span class="p">()</span>
        <span class="p">}</span>
        <span class="n">result</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">agg_result</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

<span class="c1"># âœ… å¿«é€Ÿç¾¤çµ„æ“ä½œ
</span><span class="k">def</span> <span class="nf">fast_groupby</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">df</span><span class="p">.</span><span class="n">groupby</span><span class="p">(</span><span class="s">'group'</span><span class="p">).</span><span class="n">agg</span><span class="p">({</span>
        <span class="s">'value1'</span><span class="p">:</span> <span class="s">'mean'</span><span class="p">,</span>
        <span class="s">'value2'</span><span class="p">:</span> <span class="s">'sum'</span>
    <span class="p">}).</span><span class="n">reset_index</span><span class="p">()</span>

<span class="c1"># æ•ˆèƒ½æ¸¬è©¦
</span><span class="k">print</span><span class="p">(</span><span class="s">"æ…¢é€Ÿæ–¹æ³•:"</span><span class="p">)</span>
<span class="n">time_it</span><span class="p">(</span><span class="n">slow_groupby</span><span class="p">)</span>    <span class="c1"># ~2 ç§’
</span>
<span class="k">print</span><span class="p">(</span><span class="s">"å¿«é€Ÿæ–¹æ³•:"</span><span class="p">)</span>
<span class="n">time_it</span><span class="p">(</span><span class="n">fast_groupby</span><span class="p">)</span>    <span class="c1"># ~0.05 ç§’
</span></code></pre></div></div>

<h3 id="é€²éš-groupby-æŠ€å·§">é€²éš GroupBy æŠ€å·§</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># å¤šé‡èšåˆæ“ä½œ
</span><span class="n">agg_functions</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">'value1'</span><span class="p">:</span> <span class="p">[</span><span class="s">'mean'</span><span class="p">,</span> <span class="s">'std'</span><span class="p">,</span> <span class="s">'min'</span><span class="p">,</span> <span class="s">'max'</span><span class="p">],</span>
    <span class="s">'value2'</span><span class="p">:</span> <span class="p">[</span><span class="s">'sum'</span><span class="p">,</span> <span class="s">'count'</span><span class="p">],</span>
    <span class="s">'date'</span><span class="p">:</span> <span class="p">[</span><span class="s">'min'</span><span class="p">,</span> <span class="s">'max'</span><span class="p">]</span>
<span class="p">}</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="n">groupby</span><span class="p">(</span><span class="s">'group'</span><span class="p">).</span><span class="n">agg</span><span class="p">(</span><span class="n">agg_functions</span><span class="p">)</span>

<span class="c1"># æ‰å¹³åŒ–æ¬„ä½åç¨±
</span><span class="n">result</span><span class="p">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s">'_'</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">col</span><span class="p">).</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">result</span><span class="p">.</span><span class="n">columns</span><span class="p">]</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="p">.</span><span class="n">reset_index</span><span class="p">()</span>

<span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">head</span><span class="p">())</span>
</code></pre></div></div>

<h2 id="è¨˜æ†¶é«”ç®¡ç†èˆ‡ç›£æ§-">è¨˜æ†¶é«”ç®¡ç†èˆ‡ç›£æ§ ğŸ“ˆ</h2>

<h3 id="ç›£æ§è¨˜æ†¶é«”ä½¿ç”¨">ç›£æ§è¨˜æ†¶é«”ä½¿ç”¨</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">memory_usage_check</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s">""</span><span class="p">):</span>
    <span class="s">"""æª¢æŸ¥ DataFrame è¨˜æ†¶é«”ä½¿ç”¨"""</span>
    <span class="n">memory_mb</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="n">memory_usage</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="bp">True</span><span class="p">).</span><span class="nb">sum</span><span class="p">()</span> <span class="o">/</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">2</span>
    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">message</span><span class="si">}</span><span class="s"> è¨˜æ†¶é«”ä½¿ç”¨: </span><span class="si">{</span><span class="n">memory_mb</span><span class="si">:</span><span class="p">.</span><span class="mi">2</span><span class="n">f</span><span class="si">}</span><span class="s"> MB"</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">memory_mb</span>

<span class="c1"># ä½¿ç”¨ç¯„ä¾‹
</span><span class="n">original_memory</span> <span class="o">=</span> <span class="n">memory_usage_check</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s">"åŸå§‹è³‡æ–™"</span><span class="p">)</span>
<span class="n">optimized_memory</span> <span class="o">=</span> <span class="n">memory_usage_check</span><span class="p">(</span><span class="n">df_optimized</span><span class="p">,</span> <span class="s">"å„ªåŒ–å¾Œ"</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"ç¯€çœè¨˜æ†¶é«”: </span><span class="si">{</span><span class="p">((</span><span class="n">original_memory</span> <span class="o">-</span> <span class="n">optimized_memory</span><span class="p">)</span> <span class="o">/</span> <span class="n">original_memory</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="si">:</span><span class="p">.</span><span class="mi">1</span><span class="n">f</span><span class="si">}</span><span class="s">%"</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="å³æ™‚è¨˜æ†¶é«”æ¸…ç†">å³æ™‚è¨˜æ†¶é«”æ¸…ç†</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">gc</span>

<span class="k">def</span> <span class="nf">cleanup_memory</span><span class="p">():</span>
    <span class="s">"""å¼·åˆ¶åƒåœ¾å›æ”¶"""</span>
    <span class="n">gc</span><span class="p">.</span><span class="n">collect</span><span class="p">()</span>
    
<span class="c1"># åœ¨è™•ç†å¤§è³‡æ–™æ™‚å®šæœŸæ¸…ç†
</span><span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">'large_file.csv'</span><span class="p">,</span> <span class="n">chunksize</span><span class="o">=</span><span class="mi">10000</span><span class="p">):</span>
    <span class="c1"># è™•ç†è³‡æ–™
</span>    <span class="n">processed</span> <span class="o">=</span> <span class="n">process_chunk</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
    
    <span class="c1"># æ¸…ç†è¨˜æ†¶é«”
</span>    <span class="k">del</span> <span class="n">chunk</span>
    <span class="n">cleanup_memory</span><span class="p">()</span>
</code></pre></div></div>

<h2 id="å¹³è¡Œè™•ç†å¤šæ ¸å¿ƒå¨åŠ›-">å¹³è¡Œè™•ç†ï¼šå¤šæ ¸å¿ƒå¨åŠ› ğŸ’ª</h2>

<h3 id="ä½¿ç”¨-dask-è™•ç†è¶…å¤§è³‡æ–™">ä½¿ç”¨ Dask è™•ç†è¶…å¤§è³‡æ–™</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">dask.dataframe</span> <span class="k">as</span> <span class="n">dd</span>

<span class="c1"># è®€å–å¤§å‹è³‡æ–™é›†
</span><span class="n">dask_df</span> <span class="o">=</span> <span class="n">dd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">'massive_file.csv'</span><span class="p">)</span>

<span class="c1"># Dask æœƒè‡ªå‹•åˆ†å‰²è³‡æ–™åˆ°å¤šå€‹æ ¸å¿ƒ
</span><span class="n">result</span> <span class="o">=</span> <span class="n">dask_df</span><span class="p">.</span><span class="n">groupby</span><span class="p">(</span><span class="s">'category'</span><span class="p">).</span><span class="n">value</span><span class="p">.</span><span class="n">mean</span><span class="p">().</span><span class="n">compute</span><span class="p">()</span>

<span class="c1"># æ¯”è¼ƒ Pandas vs Dask
</span><span class="k">def</span> <span class="nf">pandas_process</span><span class="p">():</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">'large_file.csv'</span><span class="p">)</span>  <span class="c1"># å¯èƒ½æœƒ out of memory
</span>    <span class="k">return</span> <span class="n">df</span><span class="p">.</span><span class="n">groupby</span><span class="p">(</span><span class="s">'category'</span><span class="p">).</span><span class="n">value</span><span class="p">.</span><span class="n">mean</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">dask_process</span><span class="p">():</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">dd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">'large_file.csv'</span><span class="p">)</span>  <span class="c1"># åˆ†æ‰¹è®€å–
</span>    <span class="k">return</span> <span class="n">df</span><span class="p">.</span><span class="n">groupby</span><span class="p">(</span><span class="s">'category'</span><span class="p">).</span><span class="n">value</span><span class="p">.</span><span class="n">mean</span><span class="p">().</span><span class="n">compute</span><span class="p">()</span>
</code></pre></div></div>

<h3 id="å¤šé€²ç¨‹è™•ç†">å¤šé€²ç¨‹è™•ç†</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">multiprocessing</span> <span class="kn">import</span> <span class="n">Pool</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>

<span class="k">def</span> <span class="nf">process_chunk</span><span class="p">(</span><span class="n">chunk</span><span class="p">):</span>
    <span class="s">"""è™•ç†å–®å€‹ chunk çš„å‡½æ•¸"""</span>
    <span class="k">return</span> <span class="n">chunk</span><span class="p">.</span><span class="n">groupby</span><span class="p">(</span><span class="s">'group'</span><span class="p">).</span><span class="nb">sum</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">parallel_processing</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">num_processes</span><span class="o">=</span><span class="mi">4</span><span class="p">):</span>
    <span class="s">"""å¹³è¡Œè™•ç† DataFrame"""</span>
    
    <span class="c1"># åˆ†å‰²è³‡æ–™
</span>    <span class="n">chunks</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array_split</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">num_processes</span><span class="p">)</span>
    
    <span class="c1"># ä½¿ç”¨å¤šé€²ç¨‹è™•ç†
</span>    <span class="k">with</span> <span class="n">Pool</span><span class="p">(</span><span class="n">processes</span><span class="o">=</span><span class="n">num_processes</span><span class="p">)</span> <span class="k">as</span> <span class="n">pool</span><span class="p">:</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">pool</span><span class="p">.</span><span class="nb">map</span><span class="p">(</span><span class="n">process_chunk</span><span class="p">,</span> <span class="n">chunks</span><span class="p">)</span>
    
    <span class="c1"># åˆä½µçµæœ
</span>    <span class="n">final_result</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">concat</span><span class="p">(</span><span class="n">results</span><span class="p">).</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">).</span><span class="nb">sum</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">final_result</span>

<span class="c1"># ä½¿ç”¨ç¯„ä¾‹
</span><span class="n">result</span> <span class="o">=</span> <span class="n">parallel_processing</span><span class="p">(</span><span class="n">large_df</span><span class="p">,</span> <span class="n">num_processes</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="æˆ‘çš„è¸©å‘è¡€æ·šå²-">æˆ‘çš„è¸©å‘è¡€æ·šå² ğŸ’€</h2>

<h3 id="1-settingwithcopywarning-çš„é™·é˜±">1. SettingWithCopyWarning çš„é™·é˜±</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># âŒ é€™æ¨£æœƒæœ‰è­¦å‘Šï¼Œè€Œä¸”å¯èƒ½ä¸æœƒç”Ÿæ•ˆ
</span><span class="n">df_subset</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s">'value'</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">df_subset</span><span class="p">[</span><span class="s">'new_col'</span><span class="p">]</span> <span class="o">=</span> <span class="s">'something'</span>  <span class="c1"># è­¦å‘Šï¼
</span>
<span class="c1"># âœ… æ­£ç¢ºçš„åšæ³•
</span><span class="n">df_subset</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s">'value'</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">].</span><span class="n">copy</span><span class="p">()</span>  <span class="c1"># æ˜ç¢ºè¤‡è£½
</span><span class="n">df_subset</span><span class="p">[</span><span class="s">'new_col'</span><span class="p">]</span> <span class="o">=</span> <span class="s">'something'</span>  <span class="c1"># OK!
</span>
<span class="c1"># æˆ–è€…ç›´æ¥åœ¨åŸ DataFrame æ“ä½œ
</span><span class="n">df</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s">'value'</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s">'new_col'</span><span class="p">]</span> <span class="o">=</span> <span class="s">'something'</span>
</code></pre></div></div>

<h3 id="2-æ—¥æœŸæ™‚é–“è™•ç†çš„å‘">2. æ—¥æœŸæ™‚é–“è™•ç†çš„å‘</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># âŒ å­—ä¸²æ¯”è¼ƒ (è¶…æ…¢)
</span><span class="n">df</span><span class="p">[</span><span class="s">'date_str'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s">'date'</span><span class="p">].</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s">'date_str'</span><span class="p">]</span> <span class="o">&gt;</span> <span class="s">'2023-01-01'</span><span class="p">]</span>

<span class="c1"># âœ… ç›´æ¥ç”¨ datetime æ¯”è¼ƒ (è¶…å¿«)
</span><span class="n">df</span><span class="p">[</span><span class="s">'date'</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s">'date'</span><span class="p">])</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s">'date'</span><span class="p">]</span> <span class="o">&gt;</span> <span class="s">'2023-01-01'</span><span class="p">]</span>
</code></pre></div></div>

<h3 id="3-join-vs-merge-çš„é¸æ“‡">3. join vs merge çš„é¸æ“‡</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ç•¶æœ‰æ˜ç¢ºçš„ç´¢å¼•é—œä¿‚æ™‚ï¼Œjoin æ¯” merge å¿«å¾ˆå¤š
</span><span class="n">df1</span> <span class="o">=</span> <span class="n">df1</span><span class="p">.</span><span class="n">set_index</span><span class="p">(</span><span class="s">'key_col'</span><span class="p">)</span>
<span class="n">df2</span> <span class="o">=</span> <span class="n">df2</span><span class="p">.</span><span class="n">set_index</span><span class="p">(</span><span class="s">'key_col'</span><span class="p">)</span>

<span class="c1"># âœ… ä½¿ç”¨ join (è¼ƒå¿«)
</span><span class="n">result</span> <span class="o">=</span> <span class="n">df1</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">df2</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s">'inner'</span><span class="p">)</span>

<span class="c1"># è€Œä¸æ˜¯ merge (è¼ƒæ…¢)
# result = pd.merge(df1, df2, on='key_col', how='inner')
</span></code></pre></div></div>

<h2 id="å¯¦æˆ°æ¡ˆä¾‹è‚¡ç¥¨è³‡æ–™åˆ†æå„ªåŒ–-">å¯¦æˆ°æ¡ˆä¾‹ï¼šè‚¡ç¥¨è³‡æ–™åˆ†æå„ªåŒ– ğŸ“ˆ</h2>

<p>è®“æˆ‘ç”¨ä¸€å€‹å¯¦éš›ä¾‹å­ä¾†å±•ç¤ºé€™äº›æŠ€å·§ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">analyze_stock_data_slow</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="s">"""æœªå„ªåŒ–ç‰ˆæœ¬"""</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="k">for</span> <span class="n">stock</span> <span class="ow">in</span> <span class="n">df</span><span class="p">[</span><span class="s">'symbol'</span><span class="p">].</span><span class="n">unique</span><span class="p">():</span>
        <span class="n">stock_data</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s">'symbol'</span><span class="p">]</span> <span class="o">==</span> <span class="n">stock</span><span class="p">].</span><span class="n">copy</span><span class="p">()</span>
        
        <span class="c1"># è¨ˆç®—ç§»å‹•å¹³å‡ (æ…¢)
</span>        <span class="n">ma_5</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">ma_20</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">stock_data</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">4</span><span class="p">:</span>
                <span class="n">ma_5</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">stock_data</span><span class="p">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">4</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="s">'close'</span><span class="p">].</span><span class="n">mean</span><span class="p">())</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ma_5</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">nan</span><span class="p">)</span>
                
            <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">19</span><span class="p">:</span>
                <span class="n">ma_20</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">stock_data</span><span class="p">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">19</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="s">'close'</span><span class="p">].</span><span class="n">mean</span><span class="p">())</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ma_20</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">nan</span><span class="p">)</span>
        
        <span class="n">stock_data</span><span class="p">[</span><span class="s">'ma_5'</span><span class="p">]</span> <span class="o">=</span> <span class="n">ma_5</span>
        <span class="n">stock_data</span><span class="p">[</span><span class="s">'ma_20'</span><span class="p">]</span> <span class="o">=</span> <span class="n">ma_20</span>
        <span class="n">results</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">stock_data</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">pd</span><span class="p">.</span><span class="n">concat</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">analyze_stock_data_fast</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="s">"""å„ªåŒ–ç‰ˆæœ¬"""</span>
    <span class="c1"># ä½¿ç”¨å‘é‡åŒ–æ“ä½œè¨ˆç®—ç§»å‹•å¹³å‡
</span>    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="n">sort_values</span><span class="p">([</span><span class="s">'symbol'</span><span class="p">,</span> <span class="s">'date'</span><span class="p">])</span>
    <span class="n">df</span><span class="p">[</span><span class="s">'ma_5'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="n">groupby</span><span class="p">(</span><span class="s">'symbol'</span><span class="p">)[</span><span class="s">'close'</span><span class="p">].</span><span class="n">rolling</span><span class="p">(</span><span class="mi">5</span><span class="p">).</span><span class="n">mean</span><span class="p">().</span><span class="n">values</span>
    <span class="n">df</span><span class="p">[</span><span class="s">'ma_20'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="n">groupby</span><span class="p">(</span><span class="s">'symbol'</span><span class="p">)[</span><span class="s">'close'</span><span class="p">].</span><span class="n">rolling</span><span class="p">(</span><span class="mi">20</span><span class="p">).</span><span class="n">mean</span><span class="p">().</span><span class="n">values</span>
    
    <span class="k">return</span> <span class="n">df</span>

<span class="c1"># æ•ˆèƒ½æ¯”è¼ƒ
</span><span class="n">stock_df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s">'symbol'</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">choice</span><span class="p">([</span><span class="s">'AAPL'</span><span class="p">,</span> <span class="s">'GOOGL'</span><span class="p">,</span> <span class="s">'MSFT'</span><span class="p">],</span> <span class="mi">10000</span><span class="p">),</span>
    <span class="s">'date'</span><span class="p">:</span> <span class="n">pd</span><span class="p">.</span><span class="n">date_range</span><span class="p">(</span><span class="s">'2020-01-01'</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">10000</span><span class="p">),</span>
    <span class="s">'close'</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">+</span> <span class="mi">1000</span>
<span class="p">})</span>

<span class="k">print</span><span class="p">(</span><span class="s">"æœªå„ªåŒ–ç‰ˆæœ¬:"</span><span class="p">)</span>
<span class="n">time_it</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">analyze_stock_data_slow</span><span class="p">(</span><span class="n">stock_df</span><span class="p">))</span>  <span class="c1"># ~15 ç§’
</span>
<span class="k">print</span><span class="p">(</span><span class="s">"å„ªåŒ–ç‰ˆæœ¬:"</span><span class="p">)</span>
<span class="n">time_it</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">analyze_stock_data_fast</span><span class="p">(</span><span class="n">stock_df</span><span class="p">))</span>   <span class="c1"># ~0.1 ç§’
</span></code></pre></div></div>

<h2 id="æ•ˆèƒ½ç›£æ§èˆ‡-profiling-">æ•ˆèƒ½ç›£æ§èˆ‡ Profiling ğŸ”</h2>

<h3 id="ä½¿ç”¨-cprofile-æ‰¾ç“¶é ¸">ä½¿ç”¨ cProfile æ‰¾ç“¶é ¸</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">cProfile</span>
<span class="kn">import</span> <span class="nn">pstats</span>

<span class="k">def</span> <span class="nf">profile_pandas_code</span><span class="p">():</span>
    <span class="s">"""è¦åˆ†æçš„ Pandas ç¨‹å¼ç¢¼"""</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">100000</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">df</span><span class="p">.</span><span class="n">index</span> <span class="o">%</span> <span class="mi">1000</span><span class="p">).</span><span class="nb">sum</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">result</span>

<span class="c1"># æ•ˆèƒ½åˆ†æ
</span><span class="n">cProfile</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="s">'profile_pandas_code()'</span><span class="p">,</span> <span class="s">'pandas_profile.prof'</span><span class="p">)</span>

<span class="c1"># æŸ¥çœ‹çµæœ
</span><span class="n">stats</span> <span class="o">=</span> <span class="n">pstats</span><span class="p">.</span><span class="n">Stats</span><span class="p">(</span><span class="s">'pandas_profile.prof'</span><span class="p">)</span>
<span class="n">stats</span><span class="p">.</span><span class="n">sort_stats</span><span class="p">(</span><span class="s">'cumulative'</span><span class="p">).</span><span class="n">print_stats</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="ä½¿ç”¨-line_profiler-é€è¡Œåˆ†æ">ä½¿ç”¨ line_profiler é€è¡Œåˆ†æ</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># å®‰è£ line_profiler</span>
pip <span class="nb">install </span>line_profiler
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">@</span><span class="n">profile</span>  <span class="c1"># éœ€è¦ line_profiler
</span><span class="k">def</span> <span class="nf">detailed_analysis</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="c1"># æ¯ä¸€è¡Œéƒ½æœƒè¢«åˆ†æ
</span>    <span class="n">grouped</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="n">groupby</span><span class="p">(</span><span class="s">'category'</span><span class="p">)</span>  <span class="c1"># é€™è¡ŒèŠ±å¤šå°‘æ™‚é–“ï¼Ÿ
</span>    <span class="n">result</span> <span class="o">=</span> <span class="n">grouped</span><span class="p">.</span><span class="nb">sum</span><span class="p">()</span>            <span class="c1"># é€™è¡ŒèŠ±å¤šå°‘æ™‚é–“ï¼Ÿ 
</span>    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></div>

<h2 id="ç¸½çµèˆ‡æœ€ä½³å¯¦å‹™-">ç¸½çµèˆ‡æœ€ä½³å¯¦å‹™ ğŸ¯</h2>

<p>æ ¹æ“šæˆ‘çš„ç¶“é©—ï¼ŒPandas æ•ˆèƒ½å„ªåŒ–çš„é»ƒé‡‘æ³•å‰‡ï¼š</p>

<h3 id="1-å„ªå…ˆé †åº">1. å„ªå…ˆé †åº</h3>
<ol>
  <li><strong>è³‡æ–™é¡å‹å„ªåŒ–</strong> - æŠ•è³‡å ±é…¬ç‡æœ€é«˜</li>
  <li><strong>å‘é‡åŒ–æ“ä½œ</strong> - é¿å…è¿´åœˆ</li>
  <li><strong>åˆ†æ‰¹è™•ç†</strong> - æ§åˆ¶è¨˜æ†¶é«”ä½¿ç”¨</li>
  <li><strong>å¹³è¡Œè™•ç†</strong> - å–„ç”¨å¤šæ ¸å¿ƒ</li>
</ol>

<h3 id="2-é–‹ç™¼ç¿’æ…£">2. é–‹ç™¼ç¿’æ…£</h3>
<ul>
  <li>âœ… ç¸½æ˜¯å…ˆç”¨å°è³‡æ–™é›†æ¸¬è©¦</li>
  <li>âœ… å®šæœŸæª¢æŸ¥è¨˜æ†¶é«”ä½¿ç”¨</li>
  <li>âœ… ä½¿ç”¨ <code class="language-plaintext highlighter-rouge">.copy()</code> é¿å… SettingWithCopyWarning</li>
  <li>âœ… å„ªå…ˆè€ƒæ…®å‘é‡åŒ–æ“ä½œ</li>
</ul>

<h3 id="3-æ•ˆèƒ½æª¢æŸ¥æ¸…å–®">3. æ•ˆèƒ½æª¢æŸ¥æ¸…å–®</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">performance_checklist</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="s">"""Pandas æ•ˆèƒ½æª¢æŸ¥æ¸…å–®"""</span>
    
    <span class="k">print</span><span class="p">(</span><span class="s">"ğŸ” Pandas æ•ˆèƒ½æª¢æŸ¥å ±å‘Š"</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"="</span> <span class="o">*</span> <span class="mi">40</span><span class="p">)</span>
    
    <span class="c1"># 1. è³‡æ–™é¡å‹æª¢æŸ¥
</span>    <span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">1. è³‡æ–™é¡å‹åˆ†æ:"</span><span class="p">)</span>
    <span class="n">memory_usage</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="n">memory_usage</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="bp">True</span><span class="p">).</span><span class="nb">sum</span><span class="p">()</span> <span class="o">/</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">2</span>
    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"   ç¸½è¨˜æ†¶é«”ä½¿ç”¨: </span><span class="si">{</span><span class="n">memory_usage</span><span class="si">:</span><span class="p">.</span><span class="mi">2</span><span class="n">f</span><span class="si">}</span><span class="s"> MB"</span><span class="p">)</span>
    
    <span class="n">object_cols</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s">'object'</span><span class="p">]).</span><span class="n">columns</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">object_cols</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"   âš ï¸  ç™¼ç¾ </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">object_cols</span><span class="p">)</span><span class="si">}</span><span class="s"> å€‹ object æ¬„ä½ï¼Œè€ƒæ…®è½‰æ›ç‚º category"</span><span class="p">)</span>
    
    <span class="c1"># 2. é‡è¤‡å€¼æª¢æŸ¥
</span>    <span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">2. é‡è¤‡å€¼åˆ†æ:"</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="p">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">unique_ratio</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">].</span><span class="n">nunique</span><span class="p">()</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">unique_ratio</span> <span class="o">&lt;</span> <span class="mf">0.5</span> <span class="ow">and</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">].</span><span class="n">dtype</span> <span class="o">==</span> <span class="s">'object'</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"   ğŸ’¡ </span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s">: é‡è¤‡ç‡ </span><span class="si">{</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">unique_ratio</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="p">.</span><span class="mi">1</span><span class="n">f</span><span class="si">}</span><span class="s">%ï¼Œå»ºè­°è½‰ç‚º category"</span><span class="p">)</span>
    
    <span class="c1"># 3. ç©ºå€¼æª¢æŸ¥
</span>    <span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">3. ç©ºå€¼åˆ†æ:"</span><span class="p">)</span>
    <span class="n">null_cols</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="n">isnull</span><span class="p">().</span><span class="nb">sum</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">col</span><span class="p">,</span> <span class="n">null_count</span> <span class="ow">in</span> <span class="n">null_cols</span><span class="p">[</span><span class="n">null_cols</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">].</span><span class="n">items</span><span class="p">():</span>
        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"   ğŸ“Š </span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">null_count</span><span class="si">}</span><span class="s"> å€‹ç©ºå€¼ (</span><span class="si">{</span><span class="n">null_count</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="p">.</span><span class="mi">1</span><span class="n">f</span><span class="si">}</span><span class="s">%)"</span><span class="p">)</span>

<span class="c1"># ä½¿ç”¨ç¯„ä¾‹
</span><span class="n">performance_checklist</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</code></pre></div></div>

<p>è¨˜ä½ï¼Œ<strong>æ•ˆèƒ½å„ªåŒ–æ˜¯ä¸€é–€å¹³è¡¡çš„è—è¡“</strong>ã€‚ä¸è¦ç‚ºäº†å¾®å°çš„æ•ˆèƒ½æå‡è€ŒçŠ§ç‰²ç¨‹å¼ç¢¼çš„å¯è®€æ€§ã€‚å…ˆè®“ç¨‹å¼è·‘èµ·ä¾†ï¼Œå†è®“ç¨‹å¼è·‘å¾—å¿«ï¼</p>

<hr />

<h2 id="å»¶ä¼¸é–±è®€-">å»¶ä¼¸é–±è®€ ğŸ“š</h2>

<ul>
  <li>ğŸ“– <a href="https://pandas.pydata.org/docs/user_guide/enhancingperf.html">Pandas Documentation - Performance</a></li>
  <li>ğŸ¥ <a href="https://jakevdp.github.io/PythonDataScienceHandbook/">Python Data Science Handbook</a></li>
  <li>ğŸ’» <a href="https://docs.dask.org/en/stable/">Dask Documentation</a></li>
</ul>

<p>ä¸‹æ¬¡ä¾†èŠèŠ NumPy çš„æ•ˆèƒ½å„ªåŒ–æŠ€å·§ï¼Œé‚£å€‹æ›´æ˜¯æ·±ä¸è¦‹åº•çš„å‘ ğŸ˜‚</p>

<p>æœ‰ä»»ä½•å•é¡Œæ­¡è¿ç•™è¨€è¨è«–ï¼è®“æˆ‘å€‘ä¸€èµ·è®“ Pandas é£›èµ·ä¾† ğŸš€</p>]]></content><author><name>Archi Chen</name><email>magic83w@gmail.com</email></author><category term="data-science" /><category term="technical" /><category term="Python" /><category term="Pandas" /><category term="æ•ˆèƒ½å„ªåŒ–" /><category term="è³‡æ–™åˆ†æ" /><category term="DataFrame" /><summary type="html"><![CDATA[æ˜¯ä¸æ˜¯å¸¸å¸¸ç­‰ Pandas è·‘è³‡æ–™è·‘åˆ°æ‡·ç–‘äººç”Ÿï¼ŸğŸŒ ä»Šå¤©ä¾†åˆ†äº«å¹¾å€‹å¯¦æˆ°æŠ€å·§ï¼Œè®“ä½ çš„ DataFrame æ“ä½œé€Ÿåº¦æå‡ 10 å€ï¼]]></summary></entry></feed>