---
layout: default
---

<!-- Reading Progress Bar (Gaming Style) -->
<div class="reading-progress-bar">
  <div class="progress-fill"></div>
  <div class="progress-pixel-dots"></div>
</div>

<div class="post-container">
  <article class="post-single">
    <!-- Post Header -->
    <header class="post-header">
    <!-- Categories -->
    {% if page.categories.size > 0 %}
    <div class="post-categories">
      {% for category in page.categories %}
        <a href="{{ site.baseurl }}/categories/#{{ category | slugify }}" class="category-link">
          {{ category }}
        </a>
      {% endfor %}
    </div>
    {% endif %}

    <!-- Title -->
    <h1 class="post-title">{{ page.title }}</h1>

    <!-- Meta Info -->
    <div class="post-meta">
      <time class="post-date" datetime="{{ page.date | date_to_xmlschema }}">
        <svg class="icon" width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
          <path d="M4 0a1 1 0 0 1 1 1v1h6V1a1 1 0 1 1 2 0v1h1a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h1V1a1 1 0 0 1 1-1zM2 6v8h12V6H2z"/>
        </svg>
        {{ page.date | date: "%Y年%m月%d日" }}
      </time>

      <!-- Reading Time -->
      {% assign words = content | number_of_words %}
      {% assign reading_time = words | divided_by: 200 | plus: 1 %}
      <span class="reading-time">
        <svg class="icon" width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
          <path d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0zm0 1a7 7 0 1 0 0 14A7 7 0 0 0 8 1zm.5 3v4.21l2.65 1.53-.75 1.3L7 9V4h1.5z"/>
        </svg>
        約 {{ reading_time }} 分鐘閱讀
      </span>
    </div>

    <!-- Tags -->
    {% if page.tags.size > 0 %}
    <div class="post-tags">
      {% for tag in page.tags %}
        <a href="{{ site.baseurl }}/tags/#{{ tag | slugify }}" class="tag-link">#{{ tag }}</a>
      {% endfor %}
    </div>
    {% endif %}
  </header>

  <!-- Featured Image -->
  {% if page.header.teaser or page.header.image %}
  <div class="post-featured-image">
    <img src="{{ page.header.teaser | default: page.header.image | relative_url }}" 
         alt="{{ page.title }}">
  </div>
  {% endif %}

  <!-- Post Content -->
  <div class="post-content">
    {{ content }}
  </div>

  <!-- Post Footer -->
  <footer class="post-footer">
    <!-- Share Buttons -->
    <div class="share-buttons">
      <span class="share-label">分享文章</span>
      <a href="https://twitter.com/intent/tweet?text={{ page.title | uri_escape }}&url={{ page.url | absolute_url | uri_escape }}" 
         class="share-btn share-btn--twitter" target="_blank" rel="noopener">
        Twitter
      </a>
      <a href="https://www.facebook.com/sharer/sharer.php?u={{ page.url | absolute_url | uri_escape }}" 
         class="share-btn share-btn--facebook" target="_blank" rel="noopener">
        Facebook
      </a>
      <a href="https://www.linkedin.com/sharing/share-offsite/?url={{ page.url | absolute_url | uri_escape }}" 
         class="share-btn share-btn--linkedin" target="_blank" rel="noopener">
        LinkedIn
      </a>
    </div>
  </footer>

  <!-- Related Posts -->
  {% if site.related_posts.size > 0 %}
  <aside class="related-posts">
    <h2 class="related-posts__title">相關文章</h2>
    <div class="related-posts__grid">
      {% for post in site.related_posts limit:3 %}
      <article class="related-post">
        {% if post.header.teaser %}
        <div class="related-post__image">
          <a href="{{ post.url | relative_url }}">
            <img src="{{ post.header.teaser | relative_url }}" alt="{{ post.title }}">
          </a>
        </div>
        {% endif %}
        <div class="related-post__content">
          <h3 class="related-post__title">
            <a href="{{ post.url | relative_url }}">{{ post.title }}</a>
          </h3>
          <time class="related-post__date" datetime="{{ post.date | date_to_xmlschema }}">
            {{ post.date | date: "%Y.%m.%d" }}
          </time>
        </div>
      </article>
      {% endfor %}
    </div>
  </aside>
  {% endif %}

  <!-- Navigation -->
  <nav class="post-navigation">
    {% if page.previous %}
    <a href="{{ page.previous.url | relative_url }}" class="post-nav post-nav--prev">
      <span class="post-nav__label">← 上一篇</span>
      <span class="post-nav__title">{{ page.previous.title }}</span>
    </a>
    {% endif %}
    
    {% if page.next %}
    <a href="{{ page.next.url | relative_url }}" class="post-nav post-nav--next">
      <span class="post-nav__label">下一篇 →</span>
      <span class="post-nav__title">{{ page.next.title }}</span>
    </a>
    {% endif %}
  </nav>

  <!-- Comments Section -->
  {% if page.comments != false and site.comments.provider == "giscus" %}
  <section class="post-comments">
    <h2 class="post-comments__title">💬 留言討論</h2>
    <div class="giscus-wrapper">
      <script src="https://giscus.app/client.js"
              data-repo="{{ site.repository }}"
              data-repo-id="{{ site.comments.giscus.repo_id }}"
              data-category="{{ site.comments.giscus.category_name }}"
              data-category-id="{{ site.comments.giscus.category_id }}"
              data-mapping="{{ site.comments.giscus.discussion_term }}"
              data-strict="0"
              data-reactions-enabled="{{ site.comments.giscus.reactions_enabled }}"
              data-emit-metadata="0"
              data-input-position="bottom"
              data-theme="{{ site.comments.giscus.theme }}"
              data-lang="{{ site.comments.giscus.lang }}"
              crossorigin="anonymous"
              async>
      </script>
    </div>
  </section>
  {% endif %}
  </article>

  <!-- Table of Contents Sidebar -->
  <aside class="post-toc">
    <div class="toc-sticky">
      <h2 class="toc-title">目錄</h2>
      <nav class="toc-nav" id="toc">
        <!-- TOC will be generated by JavaScript -->
      </nav>
    </div>
  </aside>
</div>

<!-- Gaming Features & TOC Script -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  // ========================================
  // 1. TOC Generation
  // ========================================
  const content = document.querySelector('.post-content');
  const tocNav = document.querySelector('#toc');
  
  if (content && tocNav) {
    const headings = content.querySelectorAll('h2, h3, h4');
    
    if (headings.length === 0) {
      document.querySelector('.post-toc').style.display = 'none';
    } else {
      let tocHTML = '<ul class="toc-list">';
      
      headings.forEach((heading, index) => {
        const level = heading.tagName.toLowerCase();
        const text = heading.textContent;
        const id = `heading-${index}`;
        heading.id = id;
        
        const className = `toc-item toc-item--${level}`;
        tocHTML += `<li class="${className}"><a href="#${id}" class="toc-link">${text}</a></li>`;
      });
      
      tocHTML += '</ul>';
      tocNav.innerHTML = tocHTML;
      
      // Active state on scroll
      const tocLinks = tocNav.querySelectorAll('.toc-link');
      
      function updateActiveLink() {
        let current = '';
        headings.forEach(heading => {
          const rect = heading.getBoundingClientRect();
          if (rect.top <= 100) current = heading.id;
        });
        
        tocLinks.forEach(link => {
          link.classList.remove('active');
          if (link.getAttribute('href') === `#${current}`) {
            link.classList.add('active');
          }
        });
      }
      
      window.addEventListener('scroll', updateActiveLink);
      updateActiveLink();
    }
  }
  
  // ========================================
  // 2. Reading Progress Bar (Gaming Style)
  // ========================================
  const progressBar = document.querySelector('.reading-progress-bar');
  const progressFill = document.querySelector('.progress-fill');
  
  if (progressBar && progressFill) {
    function updateProgress() {
      const windowHeight = window.innerHeight;
      const docHeight = document.documentElement.scrollHeight;
      const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
      const trackLength = docHeight - windowHeight;
      const percentage = Math.floor((scrollTop / trackLength) * 100);
      
      progressFill.style.width = percentage + '%';
      progressFill.setAttribute('data-progress', percentage + '%');
    }
    
    window.addEventListener('scroll', updateProgress);
    updateProgress();
  }
  
  // ========================================
  // 3. Code Block Copy Button (Gaming EXP)
  // ========================================
  const codeBlocks = document.querySelectorAll('pre');
  
  codeBlocks.forEach(block => {
    // Create copy button
    const copyBtn = document.createElement('button');
    copyBtn.className = 'code-copy-btn';
    copyBtn.innerHTML = '<span class="btn-icon">📋</span><span class="btn-text">Copy</span>';
    copyBtn.setAttribute('aria-label', 'Copy code');
    
    block.style.position = 'relative';
    block.appendChild(copyBtn);
    
    copyBtn.addEventListener('click', function() {
      const code = block.querySelector('code');
      const text = code ? code.textContent : block.textContent;
      
      navigator.clipboard.writeText(text).then(() => {
        // Success animation
        copyBtn.innerHTML = '<span class="btn-icon">✨</span><span class="btn-text">+10 EXP</span>';
        copyBtn.classList.add('copied');
        
        // Show floating EXP
        const expFloat = document.createElement('div');
        expFloat.className = 'xp-float';
        expFloat.textContent = '+10 EXP';
        block.appendChild(expFloat);
        
        setTimeout(() => expFloat.remove(), 1000);
        
        // Reset button
        setTimeout(() => {
          copyBtn.innerHTML = '<span class="btn-icon">✓</span><span class="btn-text">Copied</span>';
        }, 500);
        
        setTimeout(() => {
          copyBtn.innerHTML = '<span class="btn-icon">📋</span><span class="btn-text">Copy</span>';
          copyBtn.classList.remove('copied');
        }, 2000);
      });
    });
  });
  
  // ========================================
  // 4. Heading Pixel Decorations
  // ========================================
  const h2Elements = content.querySelectorAll('h2');
  h2Elements.forEach(h2 => {
    const pixelDeco = document.createElement('span');
    pixelDeco.className = 'heading-pixel-deco';
    pixelDeco.textContent = '▸';
    h2.prepend(pixelDeco);
  });
  
  // ========================================
  // 5. Achievement: Read to Bottom
  // ========================================
  let achievementShown = false;
  
  function checkScrollBottom() {
    const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
    const scrollHeight = document.documentElement.scrollHeight;
    const clientHeight = window.innerHeight;
    
    if (scrollTop + clientHeight >= scrollHeight - 100 && !achievementShown) {
      achievementShown = true;
      showAchievement('🏆', 'Achievement Unlocked!', 'Knowledge Seeker', 'Read the entire article');
    }
  }
  
  function showAchievement(icon, title, name, desc) {
    const toast = document.createElement('div');
    toast.className = 'achievement-toast';
    toast.innerHTML = `
      <div class="achievement-header">
        <div class="achievement-icon">${icon}</div>
        <div class="achievement-title">${title}</div>
      </div>
      <div class="achievement-body">
        <div class="achievement-name">${name}</div>
        <div class="achievement-desc">${desc}</div>
      </div>
    `;
    
    document.body.appendChild(toast);
    
    // Play elegant achievement sound
    playAchievementSound();
    
    setTimeout(() => toast.remove(), 4000);
  }
  
  function playAchievementSound() {
    try {
      const audioContext = new (window.AudioContext || window.webkitAudioContext)();
      
      // Create a more elegant multi-tone achievement sound
      const now = audioContext.currentTime;
      
      // First note - C5 (523.25 Hz)
      playNote(audioContext, 523.25, now, 0.15, 0.3);
      
      // Second note - E5 (659.25 Hz)
      playNote(audioContext, 659.25, now + 0.15, 0.15, 0.3);
      
      // Third note - G5 (783.99 Hz)
      playNote(audioContext, 783.99, now + 0.3, 0.2, 0.4);
      
      // Fourth note - C6 (1046.50 Hz) - Higher octave for sparkle
      playNote(audioContext, 1046.50, now + 0.5, 0.3, 0.25);
      
    } catch(e) {
      console.log('Audio not supported');
    }
  }
  
  function playNote(audioContext, frequency, startTime, duration, volume) {
    const oscillator = audioContext.createOscillator();
    const gainNode = audioContext.createGain();
    
    oscillator.connect(gainNode);
    gainNode.connect(audioContext.destination);
    
    oscillator.type = 'sine';
    oscillator.frequency.setValueAtTime(frequency, startTime);
    
    // Smooth volume envelope (attack-decay-sustain-release)
    gainNode.gain.setValueAtTime(0, startTime);
    gainNode.gain.linearRampToValueAtTime(volume, startTime + 0.01); // Attack
    gainNode.gain.exponentialRampToValueAtTime(volume * 0.7, startTime + duration * 0.3); // Decay
    gainNode.gain.setValueAtTime(volume * 0.5, startTime + duration * 0.7); // Sustain
    gainNode.gain.exponentialRampToValueAtTime(0.01, startTime + duration); // Release
    
    oscillator.start(startTime);
    oscillator.stop(startTime + duration);
  }
  
  window.addEventListener('scroll', checkScrollBottom);
  
  // ========================================
  // 6. Scroll Particles Effect
  // ========================================
  const particlesContainer = document.createElement('div');
  particlesContainer.className = 'scroll-particles';
  for (let i = 0; i < 6; i++) {
    const particle = document.createElement('div');
    particle.className = 'particle';
    particlesContainer.appendChild(particle);
  }
  document.body.appendChild(particlesContainer);
  
  let lastScroll = 0;
  window.addEventListener('scroll', function() {
    const currentScroll = window.pageYOffset;
    if (currentScroll > lastScroll && currentScroll > 100) {
      // Scrolling down
      particlesContainer.style.display = 'block';
    } else {
      particlesContainer.style.display = 'none';
    }
    lastScroll = currentScroll;
  });
});
</script>
