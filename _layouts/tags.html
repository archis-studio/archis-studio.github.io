---
layout: default
---

<div class="tags-page-container">
  <!-- Page Header -->
  <header class="tags-header">
    <h1 class="tags-title">
      <span class="title-icon">🏷️</span>
      {{ page.title }}
      <span class="title-icon">✨</span>
    </h1>
    <p class="tags-subtitle">探索文章標籤，發現更多內容</p>
    
    <!-- Statistics -->
    <div class="tags-stats">
      <div class="stat-item">
        <span class="stat-number" id="total-tags">0</span>
        <span class="stat-label">標籤總數</span>
      </div>
      <div class="stat-item">
        <span class="stat-number" id="total-posts">0</span>
        <span class="stat-label">文章總數</span>
      </div>
    </div>
  </header>

  <!-- Search Bar -->
  <div class="tags-search-container">
    <div class="search-box">
      <span class="search-icon">🔍</span>
      <input type="text" 
             id="tag-search" 
             class="search-input" 
             placeholder="搜尋標籤...">
      <button class="search-clear" id="clear-search">✕</button>
    </div>
    
    <!-- Sort Controls -->
    <div class="sort-controls">
      <button class="sort-btn active" data-sort="popular">
        🔥 熱門
      </button>
      <button class="sort-btn" data-sort="name">
        🔤 名稱
      </button>
      <button class="sort-btn" data-sort="recent">
        ⚡ 最新
      </button>
    </div>
  </div>

  <!-- Tag Cloud -->
  <div class="tag-cloud-container">
    {% assign sorted_tags = site.tags | sort %}
    
    {% for tag in sorted_tags %}
      {% assign tag_name = tag[0] %}
      {% assign tag_posts = tag[1] %}
      {% assign post_count = tag_posts | size %}
      
      <!-- Determine tag size class -->
      {% if post_count >= 10 %}
        {% assign size_class = "tag-xl" %}
      {% elsif post_count >= 5 %}
        {% assign size_class = "tag-lg" %}
      {% elsif post_count >= 3 %}
        {% assign size_class = "tag-md" %}
      {% else %}
        {% assign size_class = "tag-sm" %}
      {% endif %}
      
      <!-- Determine tag category color -->
      {% assign lower_tag = tag_name | downcase %}
      {% if lower_tag contains "ai" or lower_tag contains "python" or lower_tag contains "javascript" or lower_tag contains "code" or lower_tag contains "dev" %}
        {% assign color_class = "tag-tech" %}
      {% elsif lower_tag contains "tutorial" or lower_tag contains "guide" or lower_tag contains "教學" or lower_tag contains "入門" %}
        {% assign color_class = "tag-tutorial" %}
      {% elsif lower_tag contains "tool" or lower_tag contains "github" or lower_tag contains "jekyll" or lower_tag contains "productivity" %}
        {% assign color_class = "tag-tool" %}
      {% elsif lower_tag contains "design" or lower_tag contains "pixel" or lower_tag contains "art" or lower_tag contains "creative" %}
        {% assign color_class = "tag-creative" %}
      {% else %}
        {% assign color_class = "tag-general" %}
      {% endif %}
      
      <a href="#tag-{{ tag_name | slugify }}" 
         class="tag-cloud-item {{ size_class }} {{ color_class }}"
         data-tag="{{ tag_name }}"
         data-count="{{ post_count }}"
         data-scroll-target="tag-{{ tag_name | slugify }}">
        <span class="tag-name">{{ tag_name }}</span>
        <span class="tag-count">{{ post_count }}</span>
      </a>
    {% endfor %}
  </div>

  <!-- Tag Details Section -->
  <div class="tag-details-container">
    {% for tag in sorted_tags %}
      {% assign tag_name = tag[0] %}
      {% assign tag_posts = tag[1] %}
      
      <section class="tag-detail-section" id="tag-{{ tag_name | slugify }}">
        <div class="tag-detail-header">
          <h2 class="tag-detail-title">
            <span class="tag-icon">🏷️</span>
            {{ tag_name }}
            <span class="tag-detail-count">({{ tag_posts | size }} 篇)</span>
          </h2>
        </div>
        
        <div class="tag-posts-grid">
          {% for post in tag_posts %}
            <article class="tag-post-card">
              {% if post.header.teaser %}
              <div class="post-card-image">
                <a href="{{ post.url | relative_url }}">
                  <img src="{{ post.header.teaser | relative_url }}" alt="{{ post.title }}">
                </a>
              </div>
              {% endif %}
              
              <div class="post-card-content">
                <h3 class="post-card-title">
                  <a href="{{ post.url | relative_url }}">{{ post.title }}</a>
                </h3>
                
                <div class="post-card-meta">
                  <time class="post-date" datetime="{{ post.date | date_to_xmlschema }}">
                    📅 {{ post.date | date: "%Y.%m.%d" }}
                  </time>
                  
                  {% if post.categories.size > 0 %}
                  <span class="post-category">
                    📁 {{ post.categories | first }}
                  </span>
                  {% endif %}
                </div>
                
                {% if post.excerpt %}
                <p class="post-card-excerpt">{{ post.excerpt | strip_html | truncatewords: 20 }}</p>
                {% endif %}
              </div>
            </article>
          {% endfor %}
        </div>
      </section>
    {% endfor %}
  </div>
</div>

<!-- Tag Achievements Sidebar -->
<aside class="tag-achievements">
  <div class="achievements-container">
    <div class="achievements-header">
      <span class="achievements-icon">🏆</span>
      <span class="achievements-title">標籤成就</span>
    </div>
    
    <div class="achievements-progress">
      <div class="progress-label">
        <span>探索進度</span>
        <span id="achievement-progress-text">0/6</span>
      </div>
      <div class="progress-bar">
        <div class="progress-fill" id="achievement-progress-bar" style="width: 0%"></div>
      </div>
    </div>
    
    <div class="achievements-list" id="achievements-list">
      <!-- Achievements will be dynamically populated -->
    </div>
  </div>
</aside>

<!-- JavaScript for Tag Cloud Interactions -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  // ========================================
  // Achievement System Configuration
  // ========================================
  const achievements = [
    {
      id: 'first-tag',
      icon: '🎯',
      name: '初次探索',
      description: '點擊第一個標籤',
      reward: '+10 EXP',
      condition: (stats) => stats.tagsClicked >= 1
    },
    {
      id: 'tag-explorer',
      icon: '🗺️',
      name: '標籤探險家',
      description: '探索 5 個不同標籤',
      reward: '+25 EXP',
      condition: (stats) => stats.tagsClicked >= 5
    },
    {
      id: 'tag-master',
      icon: '👑',
      name: '標籤大師',
      description: '瀏覽所有標籤',
      reward: '+50 EXP',
      condition: (stats) => stats.tagsClicked >= stats.totalTags
    },
    {
      id: 'search-pro',
      icon: '🔍',
      name: '搜尋達人',
      description: '使用搜尋功能 3 次',
      reward: '+15 EXP',
      condition: (stats) => stats.searchesUsed >= 3
    },
    {
      id: 'sort-expert',
      icon: '📊',
      name: '排序專家',
      description: '嘗試所有排序方式',
      reward: '+20 EXP',
      condition: (stats) => stats.sortsUsed >= 3
    },
    {
      id: 'article-reader',
      icon: '📚',
      name: '文章閱讀者',
      description: '從標籤頁點擊文章',
      reward: '+30 EXP',
      condition: (stats) => stats.articlesOpened >= 1
    }
  ];
  
  // Load or initialize user stats
  let userStats = JSON.parse(localStorage.getItem('tagPageStats') || '{}');
  userStats = {
    tagsClicked: userStats.tagsClicked || 0,
    searchesUsed: userStats.searchesUsed || 0,
    sortsUsed: userStats.sortsUsed || 0,
    articlesOpened: userStats.articlesOpened || 0,
    totalTags: document.querySelectorAll('.tag-cloud-item').length,
    unlockedAchievements: userStats.unlockedAchievements || [],
    clickedTags: userStats.clickedTags || []
  };
  
  function saveStats() {
    localStorage.setItem('tagPageStats', JSON.stringify(userStats));
  }
  
  function checkAndUnlockAchievements() {
    achievements.forEach(achievement => {
      if (!userStats.unlockedAchievements.includes(achievement.id)) {
        if (achievement.condition(userStats)) {
          unlockAchievement(achievement);
        }
      }
    });
    updateAchievementsDisplay();
  }
  
  function unlockAchievement(achievement) {
    userStats.unlockedAchievements.push(achievement.id);
    saveStats();
    showAchievementToast(achievement);
    playUnlockSound();
  }
  
  function showAchievementToast(achievement) {
    const toast = document.createElement('div');
    toast.className = 'achievement-unlock-toast';
    toast.innerHTML = `
      <div class="toast-header">
        <span class="toast-icon">${achievement.icon}</span>
        <span class="toast-title">成就解鎖！</span>
      </div>
      <div class="toast-body">
        <div class="toast-name">${achievement.name}</div>
        <div class="toast-desc">${achievement.description}</div>
        <div class="toast-reward">${achievement.reward}</div>
      </div>
    `;
    
    document.body.appendChild(toast);
    setTimeout(() => toast.remove(), 4000);
  }
  
  function playUnlockSound() {
    try {
      const audioContext = new (window.AudioContext || window.webkitAudioContext)();
      const now = audioContext.currentTime;
      
      // Achievement unlock chord (C-E-G-C major)
      [523.25, 659.25, 783.99, 1046.50].forEach((freq, i) => {
        const oscillator = audioContext.createOscillator();
        const gainNode = audioContext.createGain();
        
        oscillator.connect(gainNode);
        gainNode.connect(audioContext.destination);
        
        oscillator.frequency.value = freq;
        oscillator.type = 'sine';
        
        const startTime = now + (i * 0.1);
        gainNode.gain.setValueAtTime(0, startTime);
        gainNode.gain.linearRampToValueAtTime(0.2, startTime + 0.01);
        gainNode.gain.exponentialRampToValueAtTime(0.01, startTime + 0.4);
        
        oscillator.start(startTime);
        oscillator.stop(startTime + 0.4);
      });
    } catch(e) {}
  }
  
  function updateAchievementsDisplay() {
    const achievementsList = document.getElementById('achievements-list');
    const progressBar = document.getElementById('achievement-progress-bar');
    const progressText = document.getElementById('achievement-progress-text');
    
    const unlockedCount = userStats.unlockedAchievements.length;
    const totalCount = achievements.length;
    const progress = (unlockedCount / totalCount) * 100;
    
    progressBar.style.width = progress + '%';
    progressText.textContent = `${unlockedCount}/${totalCount}`;
    
    achievementsList.innerHTML = achievements.map(achievement => {
      const isUnlocked = userStats.unlockedAchievements.includes(achievement.id);
      return `
        <div class="achievement-item ${isUnlocked ? 'unlocked' : 'locked'}">
          <span class="achievement-icon">${achievement.icon}</span>
          <div class="achievement-info">
            <div class="achievement-name">${achievement.name}</div>
            <div class="achievement-desc">${achievement.description}</div>
            ${isUnlocked ? `<div class="achievement-reward">${achievement.reward}</div>` : ''}
          </div>
        </div>
      `;
    }).join('');
  }
  
  // Initialize achievements display
  updateAchievementsDisplay();
  
  // ========================================
  // Original functionality with achievement tracking
  // ========================================
  
  // Update statistics
  const totalTags = document.querySelectorAll('.tag-cloud-item').length;
  const totalPosts = Array.from(document.querySelectorAll('.tag-cloud-item'))
    .reduce((sum, tag) => sum + parseInt(tag.dataset.count), 0);
  
  document.getElementById('total-tags').textContent = totalTags;
  document.getElementById('total-posts').textContent = totalPosts;
  
  // Search functionality
  const searchInput = document.getElementById('tag-search');
  const clearBtn = document.getElementById('clear-search');
  const tagItems = document.querySelectorAll('.tag-cloud-item');
  
  searchInput.addEventListener('input', function() {
    const query = this.value.toLowerCase();
    
    tagItems.forEach(tag => {
      const tagName = tag.dataset.tag.toLowerCase();
      if (tagName.includes(query)) {
        tag.style.display = 'inline-flex';
        tag.classList.add('search-match');
      } else {
        tag.style.display = 'none';
        tag.classList.remove('search-match');
      }
    });
    
    clearBtn.style.display = query ? 'block' : 'none';
    
    // Track search usage
    if (query.length > 0) {
      userStats.searchesUsed++;
      saveStats();
      checkAndUnlockAchievements();
    }
  });
  
  clearBtn.addEventListener('click', function() {
    searchInput.value = '';
    searchInput.dispatchEvent(new Event('input'));
    searchInput.focus();
  });
  
  // Sort functionality
  const sortBtns = document.querySelectorAll('.sort-btn');
  const tagCloud = document.querySelector('.tag-cloud-container');
  
  sortBtns.forEach(btn => {
    btn.addEventListener('click', function() {
      sortBtns.forEach(b => b.classList.remove('active'));
      this.classList.add('active');
      
      const sortType = this.dataset.sort;
      const tagsArray = Array.from(tagItems);
      
      tagsArray.sort((a, b) => {
        if (sortType === 'popular') {
          return parseInt(b.dataset.count) - parseInt(a.dataset.count);
        } else if (sortType === 'name') {
          return a.dataset.tag.localeCompare(b.dataset.tag);
        } else if (sortType === 'recent') {
          // For now, reverse popular (you can enhance this later)
          return parseInt(b.dataset.count) - parseInt(a.dataset.count);
        }
      });
      
      tagsArray.forEach(tag => tagCloud.appendChild(tag));
    });
  });
  
  // Smooth scroll to tag section
  document.querySelectorAll('.tag-cloud-item').forEach(item => {
    item.addEventListener('click', function(e) {
      e.preventDefault();
      const targetId = this.dataset.scrollTarget;
      const targetElement = document.getElementById(targetId);
      const tagName = this.dataset.tag;
      
      if (targetElement) {
        targetElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
        
        // Highlight animation
        targetElement.classList.add('highlight-flash');
        setTimeout(() => {
          targetElement.classList.remove('highlight-flash');
        }, 2000);
      }
      
      // Track tag clicks
      if (!userStats.clickedTags.includes(tagName)) {
        userStats.clickedTags.push(tagName);
        userStats.tagsClicked = userStats.clickedTags.length;
        saveStats();
        checkAndUnlockAchievements();
      }
    });
  });
  
  // Track article opens
  document.querySelectorAll('.tag-post-card a').forEach(link => {
    link.addEventListener('click', function() {
      userStats.articlesOpened++;
      saveStats();
      checkAndUnlockAchievements();
    });
  });
  
  // Hover sound effect (optional, subtle)
  tagItems.forEach(tag => {
    tag.addEventListener('mouseenter', function() {
      this.classList.add('tag-hover');
    });
    
    tag.addEventListener('mouseleave', function() {
      this.classList.remove('tag-hover');
    });
  });
});
</script>
